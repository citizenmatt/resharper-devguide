


<!doctype html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title> / ReSharper  DevGuide</title>
    <link rel="stylesheet" href="/resharper-devguide/app/css/styles.min.css">
<link  rel="stylesheet" href="/resharper-devguide/styles/styles.css"></head>
<body data-id="Plugins/Testing">
<div class="wrapper">
    <section class="panel _nav">
        <header class="panel__header">
            <div class="container">
                <form class="search-box">
                    <label for="search-box__input" class="search-box__label">
                        <input type="text" class="search-box__input" id="search-box__input" placeholder="Search ReSharper  DevGuide">
                    </label>
                    <div class="search-box__clear" title="Clear"></div>
                </form>
            </div>
        </header>
        <nav class="panel__content">
            <div class="container _nav">
                <menu class="nav-tree"></menu>
            </div>
            <div class="container _footer panel__footer">
                <p><a href="mailto:feedback@jetbrains.com">Send feedback</a></p>
                <p>&copy; 2000&ndash;2015 <a href="//www.jetbrains.com">JetBrains</a> s.r.o.<br>
                    All rights reserved.</p>
            </div>
        </nav>
    </section>

    <main class="panel _main" role="main">
        <header class="panel__header">
            <div class="container">
                <h3>ReSharper DevGuide</h3>
                
        <div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1">
            <option data-group="primary" value="default" selected>Default</option>
            <option data-group="primary" value="default_for_gnome">GNOME</option>
            <option data-group="primary" value="default_for_kde">KDE</option>
            <option data-group="primary" value="default_for_xwin">XWindow</option>
            <option data-group="primary" value="emacs">Emacs</option>
            <option data-group="primary" value="jbuilder">JBuilder</option>
            <option data-group="primary" value="visual_studio">Visual Studio</option>
            <option data-group="primary" value="netbeans_6.5">NetBeans 6.5</option>
            <option data-group="primary" value="eclipse">Eclipse</option>
            <option data-group="secondary" value="mac_os_x_10.5_">OS X 10.5+</option>
            <option data-group="secondary" value="mac_os_x">OS X</option>
            <option data-group="secondary" value="eclipse_mac_os_x">OS X Eclipse</option></select>
        </div>
    
                <div class="panel-trigger"></div>
            </div>
        </header>
        <section class="panel__content">
            <div class="container">
                <article class="article" data-shortcut-switcher="false">

                    
                    <a name="testing" class="elem-anchor"></a>
<h1>Testing<a href="#testing" class="anchor-link"><span></span></a></h1>

<aside class="warning">
  <p> This topic relates to ReSharper 8, and has not been updated to ReSharper 9 or the ReSharper Platform.</p>
</aside>

<ul id="markdown-toc">
  <li><a href="#test-environment-assembly" id="markdown-toc-test-environment-assembly"><span>Test environment assembly<a href="#test-environment-assembly" class="anchor-link"><span></span></a></span></a></li>
  <li><a href="#input-files" id="markdown-toc-input-files"><span>Input Files<a href="#input-files" class="anchor-link"><span></span></a></span></a></li>
  <li><a href="#a-note-on-file-extensions" id="markdown-toc-a-note-on-file-extensions"><span>A Note on File Extensions<a href="#a-note-on-file-extensions" class="anchor-link"><span></span></a></span></a></li>
  <li><a href="#test-data-mark-up" id="markdown-toc-test-data-mark-up"><span>Test Data Mark-up<a href="#test-data-mark-up" class="anchor-link"><span></span></a></span></a></li>
  <li><a href="#troubleshooting" id="markdown-toc-troubleshooting"><span>Troubleshooting<a href="#troubleshooting" class="anchor-link"><span></span></a></span></a></li>
</ul>

<p>ReSharper’s SDK provides infrastructure for testing your plugin.</p>

<p>But why do we need the test infrastructure? Well, if we’re talking about isolated behavior of your plugins, ordinary unit tests do just fine. However, these tests assume that you mock the ReSharper infrastructure or that your code is well-isolated from it. But the interaction with the ReSharper infrastructure is best tested with specific test infrastructure. The infrastructure lets you, e.g., spin up a real instance of Visual Studio, open up a solution and, say, try out a particular context action.</p>

<p>The general rules for testing is that for particular types of plugin items, you get corresponding base classes. For example, to test Live Template Macros, the ReSharper SDK provides a base class called MacroTestBase. By inheriting this class, you can override its members in order to, e.g., specify input and expected output files. Please note that base classes also ‘branch off’ in terms of what functionality of a particular feature they test. For example, when testing a context action, you have a base class which tests the availability of a context action, and another base class for testing its actual effects.</p>

<a name="test-environment-assembly" class="elem-anchor"></a>
<h2>Test environment assembly<a href="#test-environment-assembly" class="anchor-link"><span></span></a></h2>

<p>In order to tell ReSharper that the assembly contains tests that should be executed by the ReSharper infrastructure, the assembly must include a type decorated with the <code class="code highlight language-text">SetUpFixture</code> attribute and inheriting from <code class="code highlight language-text">ReSharperTestEnvironmentAssembly</code>.</p>

<p>NUnit will create any set up fixtures before running any tests defined in or below the namespace of the set up fixure class. For this reason, the project templates distributed with the ReSharper SDK create the set up fixture in the root namespace, and place it in the <code class="code highlight language-text">AssemblyInfo.cs</code> file.</p>

<p>However, it is also useful to move the class to a child namespace, and ensure that all acceptance tests are declared in or below this child namespace. This allows for real unit tests to also be declared in the assembly, and not pay the cost of initialising a ReSharper environment when running unit tests.</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="na">[SetUpFixture]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">MyTestEnvironmentAssembly</span> <span class="p">:</span> <span class="n">ReSharperTestEnvironmentAssembly</span>
<span class="p">{</span>
  <span class="c1">/// &lt;summary&gt;</span>
  <span class="c1">/// Gets the assemblies to load into test environment.</span>
  <span class="c1">/// Should include all assemblies which contain components.</span>
  <span class="c1">/// &lt;/summary&gt;</span>
  <span class="k">private</span> <span class="k">static</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Assembly</span><span class="p">&gt;</span> <span class="n">GetAssembliesToLoad</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="c1">// Test assembly</span>
    <span class="k">yield</span> <span class="k">return</span> <span class="n">Assembly</span><span class="p">.</span><span class="n">GetExecutingAssembly</span><span class="p">();</span>

    <span class="c1">// Plugin code - TypeUnderTest is implemented in the plugin assembly</span>
    <span class="k">yield</span> <span class="k">return</span> <span class="nf">typeof</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">TypeUnderTest</span><span class="p">)).</span><span class="n">Assembly</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">SetUp</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="k">base</span><span class="p">.</span><span class="n">SetUp</span><span class="p">();</span>
    <span class="n">ReentrancyGuard</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="n">Execute</span><span class="p">(</span><span class="s">&quot;LoadAssemblies&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> 
    <span class="p">{</span>
      <span class="n">Shell</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">AssemblyManager</span><span class="p">&gt;().</span><span class="n">LoadAssemblies</span><span class="p">(</span><span class="n">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">,</span> <span class="n">GetAssembliesToLoad</span><span class="p">()));</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">TearDown</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="n">ReentrancyGuard</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="n">Execute</span><span class="p">(</span><span class="s">&quot;UnloadAssemblies&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> 
    <span class="p">{</span>
      <span class="n">Shell</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">AssemblyManager</span><span class="p">&gt;().</span><span class="n">LoadAssemblies</span><span class="p">(</span><span class="n">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">,</span> <span class="n">GetAssembliesToLoad</span><span class="p">()));</span>
    <span class="p">}</span>
    <span class="k">base</span><span class="p">.</span><span class="n">TearDown</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>

<p>You can copy the above code verbatim into your application; just be sure to get the <code class="code highlight language-text">AssemblyManager</code> to load the assemblies containing the types you plan to test. Failure to do so will cause the infrastructure to run tests against your plugin without actually loading the plugin assemblies into the component model.</p>

<a name="input-files" class="elem-anchor"></a>
<h2>Input Files<a href="#input-files" class="anchor-link"><span></span></a></h2>

<p>If you are writing a plugin which modifies code, a typical test would involve two files - an initial input file and an expected output file. The output file is a file which represents the expected output state after a particular action has executed.</p>

<p>Input and output files involve special symbols and commands for indicating the state of the file. For example, by writing <code class="code highlight language-text">{caret}</code>, you indicate where the caret is located.</p>

<p>ReSharper adopts a convention-based approach to locating your tests. The convention suggests the following structure for the projects and the associated tests:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_text">\src
  \your_project.sln
  \your_project_files
\test
  \data
    \your_feature_name
      \availability01.cs
      \execute01.html
      \execute01.html.gold</code></pre>

<p>In the above structure, in order to get your feature files to be picked up by the test runner, you need to do the following:</p>

<ul>
  <li>Create a folder called <code class="code highlight language-text">your_feature_name</code></li>
  <li>In your test, the value of the overridden <code class="code highlight language-text">RelativeTestDataPath</code> property should correspondingly be <code class="code highlight language-text">your_feature_name</code></li>
  <li>
    <p>Your test cases should invoke the appropriate test files. For example, if your test data file is named <code class="code highlight language-text">availability01.cs</code>, your test can appear as follows:</p>

    <p><code class="code highlight language-text">csharp
  [TestCase(&quot;availability01&quot;)]
  [Test]
  public void TestExecution01(string testSrc)
  {
    DoOneTest(testSrc);
  }</code></p>
  </li>
</ul>

<a name="a-note-on-file-extensions" class="elem-anchor"></a>
<h2>A Note on File Extensions<a href="#a-note-on-file-extensions" class="anchor-link"><span></span></a></h2>

<p>Since tests typically default to searching for files with <code class="code highlight language-text">.cs</code> extensions, if you use a different extension you’ll need to tell ReSharper about it. The way to do it is by decorating the test fixture with the <code class="code highlight language-text">[TestFileExtension]</code> attribute. You can either provide it a string of the file extension (e.g., <code class="code highlight language-text">&quot;.html&quot;</code>) or reference one of the existing string constants that are kept in the project file types, for example <code class="code highlight language-text">HtmlProjectFileType.HTML_EXTENSION</code>.</p>

<a name="test-data-mark-up" class="elem-anchor"></a>
<h2>Test Data Mark-up<a href="#test-data-mark-up" class="anchor-link"><span></span></a></h2>

<p>When working with test data, you can use special symbols (delimited in curly braces) in order to specify various test-related settings. These are:</p>

<ul>
  <li><code class="code highlight language-text">{caret}</code> - indicates the position of the caret</li>
  <li><code class="code highlight language-text">{selstart}</code> and <code class="code highlight language-text">{selend}</code> - indicate the start and end position of selection</li>
  <li><code class="code highlight language-text">{sourceN}</code> and <code class="code highlight language-text">{targetN}</code> - indicate the Nth movement of the caret. the source indicates where the caret is moving from, the target where it is moving to.</li>
</ul>

<p>In addition to the above, you can set up the notation of <code class="code highlight language-text">${settingname:&lt;value&gt;</code>} in your test data. You can subsequently use the <code class="code highlight language-text">GetSetting()</code> method to read the value of the setting with the specified name in your test.</p>

<a name="troubleshooting" class="elem-anchor"></a>
<h2>Troubleshooting<a href="#troubleshooting" class="anchor-link"><span></span></a></h2>

<p>Plugin tests may fail for the following reasons:</p>

<ul>
  <li>Your component has a dependency on a Visual Studio object, such as an <code class="code highlight language-text">IVsShell</code>. In this case you have two options:
    <ul>
      <li>You can either move this component to a separate project that is not referenced by your tests; or</li>
      <li>You can edit the attribute of the component, specifying <code class="code highlight language-text">ProgramConfigurations = VS_ADDIN</code>. This ensures the component doesn’t get loaded in tests.</li>
    </ul>
  </li>
  <li>You are attempting to run tests on a plugin while that plugin is already installed in Visual Studio. When testing plugins, ReSharper takes into account all the plugins currently installed, which may cause conflicts with the plugin under test.</li>
  <li>The above may also be an issue with third-party plugins where plugin developers have forgotten to decorate VS-reliant interfaces with appropriate attributes to prevent them from being loaded in tests.</li>
</ul>



                    <div class="last-modified">
                        Last modified: 8 May 2015
                    </div>
                </article>

                <section class="disqus">
                    <div id="disqus_thread"></div>
                </section>
            </div>
        </section>
    </main>
</div>


<script data-main="/resharper-devguide/app/js/main.build" data-baseurl="/resharper-devguide/" src="/resharper-devguide/app/js/vendor/requirejs/require.js"></script>

</body>
</html>

