


<!doctype html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title> / ReSharper  DevGuide</title>
    <link rel="stylesheet" href="/resharper/devguide/app/css/styles.min.css">
<link  rel="stylesheet" href="/resharper/devguide/styles/styles.css"></head>
<body data-id="Platform/Lifetime/LifetimeDefinition">
<div class="wrapper">
    <section class="panel _nav">
        <header class="panel__header">
            <div class="container">
                <form class="search-box">
                    <label for="search-box__input" class="search-box__label">
                        <input type="text" class="search-box__input" id="search-box__input" placeholder="Search ReSharper  DevGuide">
                    </label>
                    <div class="search-box__clear" title="Clear"></div>
                </form>
            </div>
        </header>
        <nav class="panel__content">
            <div class="container _nav">
                <menu class="nav-tree"></menu>
            </div>
            <div class="container _footer panel__footer">
                <p><a href="mailto:feedback@jetbrains.com">Send feedback</a></p>
                <p>&copy; 2000&ndash;2015 <a href="//www.jetbrains.com">JetBrains</a> s.r.o.<br>
                    All rights reserved.</p>
            </div>
        </nav>
    </section>

    <main class="panel _main" role="main">
        <header class="panel__header">
            <div class="container">
                <h3>ReSharper DevGuide</h3>
                
        <div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1">
            <option data-group="primary" value="default" selected>Default</option>
            <option data-group="primary" value="default_for_gnome">GNOME</option>
            <option data-group="primary" value="default_for_kde">KDE</option>
            <option data-group="primary" value="default_for_xwin">XWindow</option>
            <option data-group="primary" value="emacs">Emacs</option>
            <option data-group="primary" value="jbuilder">JBuilder</option>
            <option data-group="primary" value="visual_studio">Visual Studio</option>
            <option data-group="primary" value="netbeans_6.5">NetBeans 6.5</option>
            <option data-group="primary" value="eclipse">Eclipse</option>
            <option data-group="secondary" value="mac_os_x_10.5_">OS X 10.5+</option>
            <option data-group="secondary" value="mac_os_x">OS X</option>
            <option data-group="secondary" value="eclipse_mac_os_x">OS X Eclipse</option></select>
        </div>
    
                <div class="panel-trigger"></div>
            </div>
        </header>
        <section class="panel__content">
            <div class="container">
                <article class="article" data-shortcut-switcher="false">

                    
                    <a name="lifetime-management" class="elem-anchor"></a>
<h1>Lifetime Management<a href="#lifetime-management" class="anchor-link"><span></span></a></h1>

<p>A lifetime is made up of two parts, the <code class="code highlight language-text">Lifetime</code> instance, which is passed around and used to register callbacks, and a <code class="code highlight language-text">LifetimeDefinition</code> which is used to manage the lifetime.</p>

<a name="lifetimedefinition" class="elem-anchor"></a>
<h2>LifetimeDefinition<a href="#lifetimedefinition" class="anchor-link"><span></span></a></h2>

<p>You cannot terminate a <code class="code highlight language-text">Lifetime</code> instance; unless you create it, you do not own it, therefore you shouldn’t terminate it. Instead, when you create a <code class="code highlight language-text">Lifetime</code>, you receive an instance of <code class="code highlight language-text">LifetimeDefinition</code>, and this class allows you to terminate the <code class="code highlight language-text">Lifetime</code>. Here’s what it looks like:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">LifetimeDefinition</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">void</span> <span class="nf">Terminate</span><span class="p">();</span>
  <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsTerminated</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">public</span> <span class="n">Lifetime</span> <span class="n">Lifetime</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span></code></pre>

<p>It is a very simple class. You can get the <code class="code highlight language-text">Lifetime</code> instance it is associated with, and calling <code class="code highlight language-text">Terminate</code> will terminate this instance. The <code class="code highlight language-text">IsTerminated</code> property will return true if <code class="code highlight language-text">Terminate</code> has been called.</p>

<p>When terminating, the callbacks registered to the <code class="code highlight language-text">Lifetime</code> are called in reverse order of registration. That is, most recently registered first. All callbacks are called, even if one throws an exception - the exception is logged, and then ignored (favouring continuing cleanup over exception reporting).</p>

<a name="lifetime-creation" class="elem-anchor"></a>
<h2>Lifetime Creation<a href="#lifetime-creation" class="anchor-link"><span></span></a></h2>

<p>You can use the <code class="code highlight language-text">Lifetimes</code> class to create your own <code class="code highlight language-text">Lifetime</code> instances.</p>

<aside class="note">
  <p> You should normally let the Component Model <a href="ComponentModel.html"><span>create a <code class="code highlight language-text">Lifetime</code> for your component</span></a>.</p>
</aside>

<a name="short-lived-lifetimes" class="elem-anchor"></a>
<h3>Short lived Lifetimes<a href="#short-lived-lifetimes" class="anchor-link"><span></span></a></h3>

<p>If you only need a <code class="code highlight language-text">Lifetime</code> for a short period of time, the <code class="code highlight language-text">Lifetimes.Using(Action&lt;Lifetime&gt; f)</code> method will create a new instance, call your method and then immediately terminate the <code class="code highlight language-text">Lifetime</code>. There is also an overload that takes in a <code class="code highlight language-text">Func&lt;Lifetime, TRetval&gt;</code> to allow your method to return a value.</p>

<a name="nested-lifetimes" class="elem-anchor"></a>
<h3>Nested Lifetimes<a href="#nested-lifetimes" class="anchor-link"><span></span></a></h3>

<p>If you want a longer-lived <code class="code highlight language-text">Lifetime</code>, you can call <code class="code highlight language-text">Lifetimes.Define</code>:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="n">Lifetimes</span><span class="p">.</span><span class="n">Define</span><span class="p">(</span><span class="n">Lifetime</span> <span class="n">lifetime</span><span class="p">,</span> <span class="kt">string</span> <span class="n">id</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">LifetimeDefinition</span><span class="p">,</span> <span class="n">Lifetime</span><span class="p">&gt;</span> <span class="n">action</span><span class="p">,</span> <span class="n">ILogger</span> <span class="n">logger</span><span class="p">);</span></code></pre>

<p>This method takes in a <code class="code highlight language-text">Lifetime</code> to act as a parent; the new <code class="code highlight language-text">Lifetime</code> is a “nested” lifetime. Terminating the parent <code class="code highlight language-text">Lifetime</code> will also terminate this new child <code class="code highlight language-text">Lifetime</code>. Of course, if the child terminates first, it removes itself from the parent’s cleanup.</p>

<aside class="note">
  <p> If you don’t have a parent <code class="code highlight language-text">Lifetime</code> available, you can use <code class="code highlight language-text">EternalLifetime.Instance</code>. Generally speaking, <code class="code highlight language-text">EternalLifetime</code> should be avoided, as it is never terminated. Items scheduled against <code class="code highlight language-text">EternalLifetime</code> will not run, and will not get garbage collected, effectively resulting in a memory leak. The preferred use case for <code class="code highlight language-text">EternalLifetime</code> is to act as a parent for another <code class="code highlight language-text">Lifetime</code>.</p>
</aside>

<p>The <code class="code highlight language-text">Define</code> method has a number of optional parameters, firstly an id, which is only used for diagnostic purposes. Secondly, an action that is called as soon as the <code class="code highlight language-text">LifetimeDefinition</code> has been created. And finally, an optional instance of <code class="code highlight language-text">ILogger</code>. If no logger is passed in, the default logger instance from <code class="code highlight language-text">Logger.Interface</code> is used (see the Logging section for more details on logging).</p>



                    <div class="last-modified">
                        Last modified: 8 May 2015
                    </div>
                </article>

                <section class="disqus">
                    <div id="disqus_thread"></div>
                </section>
            </div>
        </section>
    </main>
</div>


<script data-main="/resharper/devguide/app/js/main.build" data-baseurl="/resharper/devguide/" src="/resharper/devguide/app/js/vendor/requirejs/require.js"></script>

</body>
</html>

