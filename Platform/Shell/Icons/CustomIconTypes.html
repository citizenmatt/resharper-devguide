


<!doctype html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title> / ReSharper  DevGuide</title>
    <link rel="stylesheet" href="/resharper/devguide/app/css/styles.min.css">
<link  rel="stylesheet" href="/resharper/devguide/styles/styles.css"></head>
<body data-id="Platform/Shell/Icons/CustomIconTypes">
<div class="wrapper">
    <section class="panel _nav">
        <header class="panel__header">
            <div class="container">
                <form class="search-box">
                    <label for="search-box__input" class="search-box__label">
                        <input type="text" class="search-box__input" id="search-box__input" placeholder="Search ReSharper  DevGuide">
                    </label>
                    <div class="search-box__clear" title="Clear"></div>
                </form>
            </div>
        </header>
        <nav class="panel__content">
            <div class="container _nav">
                <menu class="nav-tree"></menu>
            </div>
            <div class="container _footer panel__footer">
                <p><a href="mailto:feedback@jetbrains.com">Send feedback</a></p>
                <p>&copy; 2000&ndash;2015 <a href="//www.jetbrains.com">JetBrains</a> s.r.o.<br>
                    All rights reserved.</p>
            </div>
        </nav>
    </section>

    <main class="panel _main" role="main">
        <header class="panel__header">
            <div class="container">
                <h3>ReSharper DevGuide</h3>
                
        <div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1">
            <option data-group="primary" value="default" selected>Default</option>
            <option data-group="primary" value="default_for_gnome">GNOME</option>
            <option data-group="primary" value="default_for_kde">KDE</option>
            <option data-group="primary" value="default_for_xwin">XWindow</option>
            <option data-group="primary" value="emacs">Emacs</option>
            <option data-group="primary" value="jbuilder">JBuilder</option>
            <option data-group="primary" value="visual_studio">Visual Studio</option>
            <option data-group="primary" value="netbeans_6.5">NetBeans 6.5</option>
            <option data-group="primary" value="eclipse">Eclipse</option>
            <option data-group="secondary" value="mac_os_x_10.5_">OS X 10.5+</option>
            <option data-group="secondary" value="mac_os_x">OS X</option>
            <option data-group="secondary" value="eclipse_mac_os_x">OS X Eclipse</option></select>
        </div>
    
                <div class="panel-trigger"></div>
            </div>
        </header>
        <section class="panel__content">
            <div class="container">
                <article class="article" data-shortcut-switcher="false">

                    
                    <a name="custom-icon-types" class="elem-anchor"></a>
<h1>Custom Icon Types<a href="#custom-icon-types" class="anchor-link"><span></span></a></h1>

<p>It is possible to create a custom icon type, if the existing item types do not meet requirements. For example, the image could be retrieved from the filesystem, rather than compiled into an assembly.</p>

<p>To create a custom file type, you need to create a class that derives from <code class="code highlight language-text">IconId</code>. This class identifies your image, and should provide enough information to be able to create an image. It should be a value type, and must override the various <code class="code highlight language-text">Equals</code>, <code class="code highlight language-text">CompareTo</code> and <code class="code highlight language-text">GetHashCode</code> methods to be able to properly compare two instances as the same.</p>

<p>Each <code class="code highlight language-text">IconId</code> is associated with a class that implements <code class="code highlight language-text">IIconIdOwner</code>, and is marked with the <code class="code highlight language-text">[ShellComponent]</code> attribute. This class is responsible for taking the information in the <code class="code highlight language-text">IconId</code> derived class and retrieving the icon.</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IIconIdOwner</span>
<span class="p">{</span>
    <span class="n">Type</span> <span class="n">IconIdType</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="n">ImageSource</span> <span class="nf">TryGetImage</span><span class="p">(</span><span class="n">IconId</span> <span class="n">iconid</span><span class="p">,</span> <span class="n">IconTheme</span> <span class="n">theme</span><span class="p">,</span> <span class="n">IThemedIconManagerPerThemeCache</span> <span class="n">themedIconManagerPerThemeCache</span><span class="p">,</span> <span class="n">OnError</span> <span class="n">onerror</span><span class="p">);</span>
<span class="p">}</span></code></pre>

<p>The <code class="code highlight language-text">IconIdType</code> member should return the <code class="code highlight language-text">Type</code> of the derived <code class="code highlight language-text">IconId</code> that the owner handles. When trying to get an image from an <code class="code highlight language-text">IconId</code>, this type is used to lookup which class can handle the icon.</p>

<p>The <code class="code highlight language-text">TryGetImage</code> method is called to retrieve the image. The owner class should downcast the passed icon ID to the type of <code class="code highlight language-text">IconId</code> it supports, extract the information and use that to retrieve the image. It should always return something. If it can’t find an image, or if an error happens, it should return <code class="code highlight language-text">IconPlaceholder.IconPlaceholderAvalon</code>, which is a WPF <code class="code highlight language-text">ImageSource</code> that represents a broken icon (an icon with a cross).</p>

<p>In the case of an error, the class should pass any exception to the <code class="code highlight language-text">Handle</code> method on the <code class="code highlight language-text">onerror</code> parameter, and return the placeholder image.</p>

<a name="using-existing-icons" class="elem-anchor"></a>
<h2>Using existing icons<a href="#using-existing-icons" class="anchor-link"><span></span></a></h2>

<p>If the icon owner needs to use other icons, perhaps to apply an overlay (although the <code class="code highlight language-text">CompositeIconId</code> should handle this), it can use the <code class="code highlight language-text">IThemedIconManagerPerThemeCache</code> instance that gets passed in. This interface is a cache of existing icons for the current theme, and can be used to get an icon image, as a WPF <code class="code highlight language-text">ImageSource</code> or a <code class="code highlight language-text">System.Drawing.Bitmap</code> for a particular DPI.</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IThemedIconManagerPerThemeCache</span>
<span class="p">{</span>
    <span class="n">ImageSource</span> <span class="nf">GetIconImageSource</span><span class="p">([</span><span class="n">NotNull</span><span class="p">]</span> <span class="n">IconId</span> <span class="n">iconid</span><span class="p">);</span>
    <span class="n">Bitmap</span> <span class="nf">GetIconGdipBitmap</span><span class="p">([</span><span class="n">NotNull</span><span class="p">]</span> <span class="n">IconId</span> <span class="n">id</span><span class="p">,</span> <span class="n">RasterizationResolution</span> <span class="n">resolution</span><span class="p">);</span>
    <span class="n">ImageSource</span> <span class="nf">TryGetIconImageSource</span><span class="p">([</span><span class="n">NotNull</span><span class="p">]</span> <span class="n">IconId</span> <span class="n">id</span><span class="p">);</span>
<span class="p">}</span></code></pre>

<p>The images are created on demand, or pulled from the in-memory cache. The <code class="code highlight language-text">GetIconImageSource</code> will return the appropriate image, or will return the placeholder. The <code class="code highlight language-text">TryGetIconImageSource</code> method will return <code class="code highlight language-text">null</code> if it can’t find the requested icon.</p>

<a name="theming" class="elem-anchor"></a>
<h2>Theming<a href="#theming" class="anchor-link"><span></span></a></h2>

<p>It is up to the icon owner to handle theming. Some icons don’t partake in theming, for example, <code class="code highlight language-text">ColorIconId</code> returns a solid block of colour, which is not appropriate for theming.</p>

<p>When asked for an icon, one of the items to be passed in is an instance of <code class="code highlight language-text">IconTheme</code>. An icon theme is made up of a number of aspects, represented by an array of <code class="code highlight language-text">IconThemeAspect</code> instances. There are currently two types of aspect that are recognised - “Generic” and “PsiSymbol”.</p>

<p>The generic aspect represents the colour scheme used by the current theme - colour, gray or dark gray. This can be set explicitly by the user, or set to “automatic”, where the aspect is chosen based on the Visual Studio theme. ReSharper analyses the theme to see if it is monochrome, and to see if it is light or dark. For the Blue theme, this gives <code class="code highlight language-text">GenericThemeAspect.Color</code>. For the Light theme, <code class="code highlight language-text">GenericThemeAspect.Gray</code>, and the Dark theme gives <code class="code highlight language-text">GenericThemeAspect.DarkGray</code>.</p>

<p>The “PsiSymbol” aspect is used to choose which icon set to use for PSI elements such as methods, properties, etc. in code completion lists and file structure windows and so on. Again, this value can be set by the user, but by default is set to automatic. ReSharper will look at the current Visual Studio theme and version, and choose the appropriate symbol set:</p>

<ul>
  <li><code class="code highlight language-text">PsiSymbolIconThemeAspect.SymbolsIdea</code> provides symbols based on IntelliJ IDEA</li>
  <li><code class="code highlight language-text">PsiSymbolIconThemeAspect.SymbolsVs08</code> provides symbols used in Visual Studio 2008</li>
  <li><code class="code highlight language-text">PsiSymbolIconThemeAspect.SymbolsVsColor</code> provides colour symbols as used in Visual Studio 2012 and later</li>
  <li><code class="code highlight language-text">PsiSymbolIconThemeAspect.SymbolsVs11Gray</code> provides monochrome VS2012 symbols for use on a light background</li>
  <li><code class="code highlight language-text">PsiSymbolIconThemeAspect.SymbolsVs11GrayDark</code> provides monochrome VS2012 symbols for use on a dark background</li>
</ul>

<p>When the <code class="code highlight language-text">IIconIdOwner</code> class needs to return a themed icon, it should look at <code class="code highlight language-text">IconTheme.Aspects</code> for aspects it recognises. The array is in priority order, and there may be more than one entry for each aspect kind, to allow for fallbacks. The icon owner should compare the aspect against the known static aspects listed above. When it recognises that aspect, it should provide the appropriate icon.</p>

<p>How the icon owner chooses to get a theme aspect specific icon is up to the implementation of the icon owner. <code class="code highlight language-text">CompiledIconId</code> icons embed several different versions of the icons into an assembly’s resources, and the owner simply retrieves the version of the icon that matches the aspect. The <code class="code highlight language-text">ShellFileIconIdOwner</code> on the other hand, retrieves a file type icon from the operating system, looks for the <code class="code highlight language-text">GenericIconThemeAspect.Gray</code> theme aspect and makes the icon monochrome using <code class="code highlight language-text">ColorManagement.MakeMonochrome</code>.</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="n">BitmapSource</span> <span class="n">bmp</span> <span class="p">=</span> <span class="n">GetFileIcon</span><span class="p">(</span><span class="n">iconid</span><span class="p">.</span><span class="n">ExtensionWithDot</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">theme</span><span class="p">.</span><span class="n">Aspects</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">GenericIconThemeAspect</span><span class="p">.</span><span class="n">Gray</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">ColorManagement</span><span class="p">.</span><span class="n">MakeMonochrome</span><span class="p">(</span><span class="n">bmp</span><span class="p">);</span></code></pre>

<p>Both the Light and Dark themes will contain the <code class="code highlight language-text">Gray</code> aspect, but the priority ordering is different. This allows for fallback icons.</p>

<aside class="note">
  <p> the <code class="code highlight language-text">IIconIdOwner</code> class does not need to perform caching. ReSharper will only call the class once per icon per theme. However, the caches are cleared each time the theme changes, so the owner will be called again.</p>
</aside>



                    <div class="last-modified">
                        Last modified: 8 May 2015
                    </div>
                </article>

                <section class="disqus">
                    <div id="disqus_thread"></div>
                </section>
            </div>
        </section>
    </main>
</div>


<script data-main="/resharper/devguide/app/js/main.build" data-baseurl="/resharper/devguide/" src="/resharper/devguide/app/js/vendor/requirejs/require.js"></script>

</body>
</html>

