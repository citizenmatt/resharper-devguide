


<!doctype html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title> / ReSharper  DevGuide</title>
    <link rel="stylesheet" href="/resharper/devguide/app/css/styles.min.css">
<link  rel="stylesheet" href="/resharper/devguide/styles/styles.css"></head>
<body data-id="Features/XmlLike">
<div class="wrapper">
    <section class="panel _nav">
        <header class="panel__header">
            <div class="container">
                <form class="search-box">
                    <label for="search-box__input" class="search-box__label">
                        <input type="text" class="search-box__input" id="search-box__input" placeholder="Search ReSharper  DevGuide">
                    </label>
                    <div class="search-box__clear" title="Clear"></div>
                </form>
            </div>
        </header>
        <nav class="panel__content">
            <div class="container _nav">
                <menu class="nav-tree"></menu>
            </div>
            <div class="container _footer panel__footer">
                <p><a href="mailto:feedback@jetbrains.com">Send feedback</a></p>
                <p>&copy; 2000&ndash;2015 <a href="//www.jetbrains.com">JetBrains</a> s.r.o.<br>
                    All rights reserved.</p>
            </div>
        </nav>
    </section>

    <main class="panel _main" role="main">
        <header class="panel__header">
            <div class="container">
                <h3>ReSharper DevGuide</h3>
                
        <div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1">
            <option data-group="primary" value="default" selected>Default</option>
            <option data-group="primary" value="default_for_gnome">GNOME</option>
            <option data-group="primary" value="default_for_kde">KDE</option>
            <option data-group="primary" value="default_for_xwin">XWindow</option>
            <option data-group="primary" value="emacs">Emacs</option>
            <option data-group="primary" value="jbuilder">JBuilder</option>
            <option data-group="primary" value="visual_studio">Visual Studio</option>
            <option data-group="primary" value="netbeans_6.5">NetBeans 6.5</option>
            <option data-group="primary" value="eclipse">Eclipse</option>
            <option data-group="secondary" value="mac_os_x_10.5_">OS X 10.5+</option>
            <option data-group="secondary" value="mac_os_x">OS X</option>
            <option data-group="secondary" value="eclipse_mac_os_x">OS X Eclipse</option></select>
        </div>
    
                <div class="panel-trigger"></div>
            </div>
        </header>
        <section class="panel__content">
            <div class="container">
                <article class="article" data-shortcut-switcher="false">

                    
                    <a name="working-with-xml-like-files" class="elem-anchor"></a>
<h1>Working with XML-like files<a href="#working-with-xml-like-files" class="anchor-link"><span></span></a></h1>

<p>ReSharper comes with support for XML and XML-specific notations such as HTML, XAML and Web.config editing. Consequently, you can use the ReSharper API in order to manipulate XML documents.</p>

<ul id="markdown-toc">
  <li><a href="#web-vs-xml" id="markdown-toc-web-vs-xml"><span>Web vs XML<a href="#web-vs-xml" class="anchor-link"><span></span></a></span></a></li>
  <li><a href="#xml" id="markdown-toc-xml"><span>XML<a href="#xml" class="anchor-link"><span></span></a></span></a>    <ul>
      <li><a href="#example-working-with-an-xml-attribute" id="markdown-toc-example-working-with-an-xml-attribute"><span>Example: working with an XML attribute<a href="#example-working-with-an-xml-attribute" class="anchor-link"><span></span></a></span></a></li>
    </ul>
  </li>
  <li><a href="#html" id="markdown-toc-html"><span>HTML<a href="#html" class="anchor-link"><span></span></a></span></a></li>
</ul>

<a name="web-vs-xml" class="elem-anchor"></a>
<h2>Web vs XML<a href="#web-vs-xml" class="anchor-link"><span></span></a></h2>

<p>The ReSharper code model distinguishes between two types of documents - web documents (i.e., documents concerning HTML) and XML documents. The distinction is important because, while XML documents are typically concerned with XML only, web documents can include many different notations in addition to HTML. Examples of such notations include JavaScript as well as mark-up for the MVC WebForms or Razor view engines.</p>

<p>Let’s take a look at the XML format first.</p>

<a name="xml" class="elem-anchor"></a>
<h2>XML<a href="#xml" class="anchor-link"><span></span></a></h2>

<p>Compared to HTML, XML is a lot easier to work with - it has a predictable structure and fairly limited variability in terms of content. Consequently, the API structures for manipulating XML are very straightforward.</p>

<p>Let’s take a look at how one would write a context action to support the conversion of an empty tag such as <code class="code highlight language-text">&lt;test&gt;&lt;/test&gt;</code> to a self-closing tag <code class="code highlight language-text">&lt;test/&gt;</code>.</p>

<p>The first thing you do is create a class that is marked with the <code class="code highlight language-text">ContextAction</code> attribute and is set to inherit from <code class="code highlight language-text">XmlContextAction</code>.</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="na">[ContextAction(</span>
<span class="na">  Group = &quot;XML&quot;,</span>
<span class="na">  Name = &quot;Collapse empty tag&quot;,</span>
<span class="na">  Description = &quot;Converts from empty opening and closing tags into empty tag&quot;,</span>
<span class="na">  Priority = 0)]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">MakeEmptyTagContextAction</span> <span class="p">:</span> <span class="n">XmlContextAction</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="nf">MakeEmptyTagContextAction</span><span class="p">(</span><span class="n">XmlContextActionDataProvider</span> <span class="n">dataProvider</span><span class="p">)</span>
    <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">dataProvider</span><span class="p">)</span>
  <span class="p">{</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>

<p>As you can see, the context action is very similar to the way you would define it for, e.g., the C# language. The only major difference is that instead of supporting a general IContextAction interface, you need to inherit from a special class. (And even that is optional - <code class="code highlight language-text">XmlContextAction</code> is simply an intermediate class that ensures you pick the right data provider.)</p>

<p>Now that you have a context action, it becomes a matter of defining the familiar Text, <code class="code highlight language-text">IsAvailable()</code> and <code class="code highlight language-text">ExecutePsiTransaction()</code> members. The <code class="code highlight language-text">IsAvailable()</code> method is the place where you would check that the tag you’re on is empty. For example:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="kt">var</span> <span class="n">tag</span> <span class="p">=</span> <span class="n">DataProvider</span><span class="p">.</span><span class="n">FindNodeAtCaret</span><span class="p">&lt;</span><span class="n">IXmlTag</span><span class="p">&gt;();</span>
<span class="k">if</span> <span class="p">(</span><span class="n">tag</span> <span class="p">==</span> <span class="k">null</span> <span class="p">||</span> <span class="n">tag</span><span class="p">.</span><span class="n">IsEmptyTag</span> <span class="p">||</span> <span class="p">!</span><span class="n">XmlTagUtil</span><span class="p">.</span><span class="n">CanBeEmptyTag</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
  <span class="k">return</span> <span class="k">false</span><span class="p">;</span></code></pre>

<p>Manipulation of XML tokens is very important if you want to do fine-tuning of your XML-related actions. To get at the token at the caret location, for example, you would write:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="kt">var</span> <span class="n">token</span> <span class="p">=</span> <span class="n">DataProvider</span><span class="p">.</span><span class="n">FindNodeAtCaret</span><span class="p">&lt;</span><span class="n">IXmlToken</span><span class="p">&gt;();</span></code></pre>

<p>Now, you can, for example, call <code class="code highlight language-text">GetTokenType()</code> to determine the type of the token you’re on. Keep in mind that <code class="code highlight language-text">IXmlToken</code> is inherited by many other interfaces such as e.g., <code class="code highlight language-text">IXmlIdentifier</code>. After determining the type of token, you can cast to the right type to get at the token-specific properties and methods.</p>

<p>Here’s a brief example: suppose you want to remove all inner nodes of a particular tag. To do this, you would take the tag’s header node and then take its next sibling. Then you would also take its last child. Finally, you would use the <code class="code highlight language-text">ModificationUtil</code> class in order to delete all children within that range:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="kt">var</span> <span class="n">header</span> <span class="p">=</span> <span class="n">tag</span><span class="p">.</span><span class="n">HeaderNode</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">first</span> <span class="p">=</span> <span class="n">header</span><span class="p">.</span><span class="n">NextSibling</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">first</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">var</span> <span class="n">last</span> <span class="p">=</span> <span class="n">tag</span><span class="p">.</span><span class="n">LastChild</span><span class="p">;</span>
  <span class="n">ModificationUtil</span><span class="p">.</span><span class="n">DeleteChildRange</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">);</span>
<span class="p">}</span></code></pre>

<p>The <code class="code highlight language-text">ModificationUtil</code> class contains several methods for adding and removing elements from the XML token tree.</p>

<a name="example-working-with-an-xml-attribute" class="elem-anchor"></a>
<h3>Example: working with an XML attribute<a href="#example-working-with-an-xml-attribute" class="anchor-link"><span></span></a></h3>

<p>Here’s a simple example: let’s suppose that you have a tag, and you want to add an attribute to it - for example, an attribute for an XML namespace. The first thing you do is acquire an <code class="code highlight language-text">XMLElementFactory</code>.</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="n">IXmlElementFactory</span> <span class="n">factory</span> <span class="p">=</span> <span class="n">XmlElementFactory</span><span class="p">.</span><span class="n">GetElementFactory</span><span class="p">(</span><span class="n">tag</span><span class="p">);</span></code></pre>

<p>Then, you can synthetically prepare the attribute declaration:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="kt">string</span> <span class="n">text</span> <span class="p">=</span> <span class="n">String</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;{0}=\&quot;{1}\&quot;&quot;</span><span class="p">,</span> <span class="n">namespacePrefix</span><span class="p">,</span> <span class="n">namespaceUrl</span><span class="p">);</span></code></pre>

<p>With the declaration, you can use the factory to create a whole XML file. This may sound ‘heavyweight’, but is in fact a convenient way to get the structures parsed and ready for subsequent insertion.</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="n">IXmlFile</span> <span class="n">file</span> <span class="p">=</span> <span class="n">factory</span><span class="p">.</span><span class="n">CreateFile</span><span class="p">(</span><span class="n">provider</span><span class="p">.</span><span class="n">PsiServices</span><span class="p">,</span> <span class="n">provider</span><span class="p">.</span><span class="n">PsiModule</span><span class="p">,</span>
                                   <span class="s">&quot;&lt;tag &quot;</span> <span class="p">+</span> <span class="n">text</span> <span class="p">+</span> <span class="s">&quot;/&gt;&quot;</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span></code></pre>

<p>Finally, you can get at the attribute in the created file and insert it into the tag you’re trying to change:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="n">IXmlAttribute</span> <span class="n">att</span> <span class="p">=</span> <span class="n">file</span><span class="p">.</span><span class="n">InnerTags</span><span class="p">.</span><span class="n">First</span><span class="p">().</span><span class="n">GetAttributes</span><span class="p">().</span><span class="n">First</span><span class="p">();</span>
<span class="n">tag</span><span class="p">.</span><span class="n">AddAttributeBefore</span><span class="p">(</span><span class="n">att</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span></code></pre>

<a name="html" class="elem-anchor"></a>
<h2>HTML<a href="#html" class="anchor-link"><span></span></a></h2>

<p>Work with HTML files is a bit different than XML. The first thing to note is that, unlike with XML, an HTML context action, for instance, would have no special base class of its own. Rather, making an HTML-related context action is simply a matter of implementing the <code class="code highlight language-text">IContextAction</code> interface. The only difference is that this context action would take an <code class="code highlight language-text">IWebContextActionDataProvider&lt;T&gt;</code> as a parameter.</p>

<p>The type parameter <code class="code highlight language-text">T</code> has to be either of type <code class="code highlight language-text">IHtmlFile</code> or one of its inheritors - <code class="code highlight language-text">IAspFile</code> and <code class="code highlight language-text">IRazorFile</code>. Here’s an outline of a context action for HTML files:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="na">[ContextAction(Group = &quot;HTML&quot;,</span>
<span class="na">  Name = &quot;Specify Id&quot;,</span>
<span class="na">  Description = &quot;Creates an &#39;id&#39; attribute for the selected tag of an XML document&quot;)]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">SpecifyIdHtmlContextAction</span> <span class="p">:</span> <span class="n">IContextAction</span><span class="p">,</span> <span class="n">IBulbItem</span>
<span class="p">{</span>
  <span class="k">private</span> <span class="k">readonly</span> <span class="n">IWebContextActionDataProvider</span><span class="p">&lt;</span><span class="n">IHtmlFile</span><span class="p">&gt;</span> <span class="n">provider</span><span class="p">;</span>

  <span class="k">public</span> <span class="nf">SpecifyIdHtmlContextAction</span><span class="p">(</span><span class="n">IWebContextActionDataProvider</span><span class="p">&lt;</span><span class="n">IHtmlFile</span><span class="p">&gt;</span> <span class="n">provider</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="n">provider</span> <span class="p">=</span> <span class="n">provider</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>

<p>Now, you’ll notice that the code for creating an id-inserting context action is very similar to what we did for XML. The only differences are in the types of tags and factories that we are using:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">public</span> <span class="kt">bool</span> <span class="nf">IsAvailable</span><span class="p">(</span><span class="n">IUserDataHolder</span> <span class="n">cache</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">var</span> <span class="n">tag</span> <span class="p">=</span> <span class="n">provider</span><span class="p">.</span><span class="n">FindNodeAtCaret</span><span class="p">&lt;</span><span class="n">IHtmlTag</span><span class="p">&gt;();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">tag</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="kt">var</span> <span class="n">idAtt</span> <span class="p">=</span> <span class="n">tag</span><span class="p">.</span><span class="n">Attributes</span><span class="p">.</span><span class="n">FirstOrDefault</span><span class="p">(</span><span class="n">a</span> <span class="p">=&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">AttributeName</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">idAtt</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">Tag</span> <span class="p">=</span> <span class="n">tag</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
<span class="p">}</span></code></pre>

<p>Now, when it comes to modifying the document tree, with Web files there is one difference: you need to explicitly create the transaction before modifying the HTML file. Here’s a piece of code that, just like in the XML example, inserts the <code class="code highlight language-text">id</code> attribute into a tag:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">public</span> <span class="k">void</span> <span class="nf">Execute</span><span class="p">(</span><span class="n">ISolution</span> <span class="n">solution</span><span class="p">,</span> <span class="n">ITextControl</span> <span class="n">textControl</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">var</span> <span class="n">psiServices</span> <span class="p">=</span> <span class="n">solution</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">IPsiServices</span><span class="p">&gt;();</span>
  <span class="k">using</span> <span class="p">(</span><span class="k">new</span> <span class="n">PsiTransactionCookie</span><span class="p">(</span><span class="n">psiServices</span><span class="p">,</span> <span class="n">DefaultAction</span><span class="p">.</span><span class="n">Commit</span><span class="p">,</span> <span class="n">Text</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="kt">var</span> <span class="n">factory</span> <span class="p">=</span> <span class="n">HtmlElementFactory</span><span class="p">.</span><span class="n">GetInstance</span><span class="p">(</span><span class="n">Tag</span><span class="p">.</span><span class="n">Language</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">dummy</span> <span class="p">=</span> <span class="n">factory</span><span class="p">.</span><span class="n">CreateHtmlTag</span><span class="p">(</span><span class="s">&quot;&lt;tag id=\&quot;\&quot;/&gt;&quot;</span><span class="p">,</span> <span class="n">Tag</span><span class="p">);</span>
    <span class="n">Tag</span><span class="p">.</span><span class="n">AddAttributeBefore</span><span class="p">(</span><span class="n">dummy</span><span class="p">.</span><span class="n">Attributes</span><span class="p">.</span><span class="n">First</span><span class="p">(),</span> <span class="k">null</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>

<p>As you can see, the principle for creating the attribute is the similar to what we had before, with the difference that instead of creating a whole file, we can simply create a tag. From then on, getting the first attribute and inserting it into our element is easy.</p>



                    <div class="last-modified">
                        Last modified: 8 May 2015
                    </div>
                </article>

                <section class="disqus">
                    <div id="disqus_thread"></div>
                </section>
            </div>
        </section>
    </main>
</div>


<script data-main="/resharper/devguide/app/js/main.build" data-baseurl="/resharper/devguide/" src="/resharper/devguide/app/js/vendor/requirejs/require.js"></script>

</body>
</html>

