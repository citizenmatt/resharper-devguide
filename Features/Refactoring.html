


<!doctype html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title> / ReSharper  DevGuide</title>
    <link rel="stylesheet" href="/resharper-devguide/app/css/styles.min.css">
<link  rel="stylesheet" href="/resharper-devguide/styles/styles.css"></head>
<body data-id="Features/Refactoring">
<div class="wrapper">
    <section class="panel _nav">
        <header class="panel__header">
            <div class="container">
                <form class="search-box">
                    <label for="search-box__input" class="search-box__label">
                        <input type="text" class="search-box__input" id="search-box__input" placeholder="Search ReSharper  DevGuide">
                    </label>
                    <div class="search-box__clear" title="Clear"></div>
                </form>
            </div>
        </header>
        <nav class="panel__content">
            <div class="container _nav">
                <menu class="nav-tree"></menu>
            </div>
            <div class="container _footer panel__footer">
                <p><a href="mailto:feedback@jetbrains.com">Send feedback</a></p>
                <p>&copy; 2000&ndash;2015 <a href="//www.jetbrains.com">JetBrains</a> s.r.o.<br>
                    All rights reserved.</p>
            </div>
        </nav>
    </section>

    <main class="panel _main" role="main">
        <header class="panel__header">
            <div class="container">
                <h3>ReSharper DevGuide</h3>
                
        <div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1">
            <option data-group="primary" value="default" selected>Default</option>
            <option data-group="primary" value="default_for_gnome">GNOME</option>
            <option data-group="primary" value="default_for_kde">KDE</option>
            <option data-group="primary" value="default_for_xwin">XWindow</option>
            <option data-group="primary" value="emacs">Emacs</option>
            <option data-group="primary" value="jbuilder">JBuilder</option>
            <option data-group="primary" value="visual_studio">Visual Studio</option>
            <option data-group="primary" value="netbeans_6.5">NetBeans 6.5</option>
            <option data-group="primary" value="eclipse">Eclipse</option>
            <option data-group="secondary" value="mac_os_x_10.5_">OS X 10.5+</option>
            <option data-group="secondary" value="mac_os_x">OS X</option>
            <option data-group="secondary" value="eclipse_mac_os_x">OS X Eclipse</option></select>
        </div>
    
                <div class="panel-trigger"></div>
            </div>
        </header>
        <section class="panel__content">
            <div class="container">
                <article class="article" data-shortcut-switcher="false">

                    
                    <a name="refactoring" class="elem-anchor"></a>
<h1>Refactoring<a href="#refactoring" class="anchor-link"><span></span></a></h1>

<p>Refactorings are one of the most powerful features of ReSharper, but also the most complicated. A refactoring can be triggered from a variety of events (e.g., from a simple edit or deliberate invocation) and can result in all sorts of operations, some involving just local code, others involving the project (e.g., renaming a file) or changing multiple files in many projects.</p>

<p>At the most simple level, a refactoring consists of three things:</p>

<ul>
  <li>The workflow</li>
  <li>The workflow provider</li>
  <li>The refactoring itself</li>
</ul>

<p>Let’s take a look at the way these components are defined.</p>

<a name="workflow" class="elem-anchor"></a>
<h2>Workflow<a href="#workflow" class="anchor-link"><span></span></a></h2>

<p>The workflow, as its name suggests, is a class which orchestrates the workflow during which the user may (or may not) perform the refactoring. Most refactorings are <em>driven</em>, meaning that the user has to go through menus which present, e.g., conflicts that this refactoring would create.</p>

<p>In the simplest terms, a refactoring is a class which inherits from <code class="code highlight language-text">DrivenRefactoringWorflow</code>. This class has quite a few members, most of which perform fairly obvious function.</p>

<p>Execution of the workflow happens in the <code class="code highlight language-text">PreExecute</code>, <code class="code highlight language-text">Execute</code> and <code class="code highlight language-text">PostExecute</code> methods. All of these, as well as other methods such as <code class="code highlight language-text">IsAvailable</code>, return a <code class="code highlight language-text">bool</code> value indicating whether this step is a success. If any of these returns <code class="code highlight language-text">false</code>, the whole transaction is rolled back and no refactorings take place.</p>

<a name="workflow-provider" class="elem-anchor"></a>
<h2>Workflow provider<a href="#workflow-provider" class="anchor-link"><span></span></a></h2>

<p>The workflow provider is a class which provides workflows for ReSharper to consume. It is a class that</p>

<ul>
  <li>Implements the <code class="code highlight language-text">IRefactorignWorkflowProvider</code> interface</li>
  <li>Is decorated with <code class="code highlight language-text">[RefactoringWorkflowProvider]</code> attribute</li>
</ul>

<p>The class has a single method - <code class="code highlight language-text">CreateWorkflow()</code> that returns an <code class="code highlight language-text">IEnumerable</code> of one or more workflows that you may wish to provide. Here is a typical example:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="na">[RefactoringWorkflowProvider]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">MakeSingletonProvider</span> <span class="p">:</span> <span class="n">IRefactoringWorkflowProvider</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">IRefactoringWorkflow</span><span class="p">&gt;</span> <span class="n">CreateWorkflow</span><span class="p">(</span><span class="n">IDataContext</span> <span class="n">dataContext</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="kt">var</span> <span class="n">solution</span> <span class="p">=</span> <span class="n">dataContext</span><span class="p">.</span><span class="n">GetData</span><span class="p">(</span><span class="n">JetBrains</span><span class="p">.</span><span class="n">ProjectModel</span><span class="p">.</span><span class="n">DataContext</span><span class="p">.</span><span class="n">DataConstants</span><span class="p">.</span><span class="n">SOLUTION</span><span class="p">);</span>
    <span class="k">yield</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">MakeSingletonWorkflow</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="s">&quot;MakeSingleton&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>

<p>The constructor parameter passed into the workflow is an action ID, which is also useful if you want to expose the refactoring as an ordinary action.</p>

<a name="the-refactoring" class="elem-anchor"></a>
<h2>The refactoring<a href="#the-refactoring" class="anchor-link"><span></span></a></h2>

<p>One of the methods we forgot to mention in the workflow is the <code class="code highlight language-text">CreateRefactoring()</code> method. This method is used to put together the refactoring worflow and the refactoring <em>driver</em> - i.e., the element which drives the refactoring to completion.</p>

<p>Thus, the refactoring itself is typically a class (let’s call it <code class="code highlight language-text">C</code>) inheriting from <code class="code highlight language-text">DrivenRefactoring&lt;Workflow, Refactoring&gt;</code>, where <code class="code highlight language-text">Workflow</code> corresponds to the refactoring workflow, and <code class="code highlight language-text">Refactoring</code> corresponds to a type of <code class="code highlight language-text">RefactoringExecBase&lt;Workflow, C&gt;</code>.</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">MakeSingletonRefactoring</span>
  <span class="p">:</span> <span class="n">DrivenRefactoring</span><span class="p">&lt;</span><span class="n">MakeSingletonWorkflow</span><span class="p">,</span>
    <span class="n">RefactoringExecBase</span><span class="p">&lt;</span><span class="n">MakeSingletonWorkflow</span><span class="p">,</span>
    <span class="n">MakeSingletonRefactoring</span><span class="p">&gt;&gt;</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="nf">MakeSingletonRefactoring</span><span class="p">(</span><span class="n">MakeSingletonWorkflow</span> <span class="n">workflow</span><span class="p">,</span> <span class="n">ISolution</span> <span class="n">solution</span><span class="p">,</span> <span class="n">IRefactoringDriver</span> <span class="n">driver</span><span class="p">)</span>
    <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">workflow</span><span class="p">,</span> <span class="n">solution</span><span class="p">,</span> <span class="n">driver</span><span class="p">)</span>
  <span class="p">{</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">Execute</span><span class="p">(</span><span class="n">IProgressIndicator</span> <span class="n">pi</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>

<p>The refactoring itself has the capability of dealing with cases where a particular refactoring is not supported on a ReSharper-supported language. For example, a particular C# refactoring might not be supported in VB, so usages after the change will not be updated. The number of such refactorings in ReSharper itself is really small, but it is likely you might need this functionality if your refactoring is, e.g., C#-only.</p>



                    <div class="last-modified">
                        Last modified: 8 May 2015
                    </div>
                </article>

                <section class="disqus">
                    <div id="disqus_thread"></div>
                </section>
            </div>
        </section>
    </main>
</div>


<script data-main="/resharper-devguide/app/js/main.build" data-baseurl="/resharper-devguide/" src="/resharper-devguide/app/js/vendor/requirejs/require.js"></script>

</body>
</html>

