


<!doctype html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title> / ReSharper  DevGuide</title>
    <link rel="stylesheet" href="/resharper-devguide/app/css/styles.min.css">
<link  rel="stylesheet" href="/resharper-devguide/styles/styles.css"></head>
<body data-id="Features/Navigation">
<div class="wrapper">
    <section class="panel _nav">
        <header class="panel__header">
            <div class="container">
                <form class="search-box">
                    <label for="search-box__input" class="search-box__label">
                        <input type="text" class="search-box__input" id="search-box__input" placeholder="Search ReSharper  DevGuide">
                    </label>
                    <div class="search-box__clear" title="Clear"></div>
                </form>
            </div>
        </header>
        <nav class="panel__content">
            <div class="container _nav">
                <menu class="nav-tree"></menu>
            </div>
            <div class="container _footer panel__footer">
                <p><a href="mailto:feedback@jetbrains.com">Send feedback</a></p>
                <p>&copy; 2000&ndash;2015 <a href="//www.jetbrains.com">JetBrains</a> s.r.o.<br>
                    All rights reserved.</p>
            </div>
        </nav>
    </section>

    <main class="panel _main" role="main">
        <header class="panel__header">
            <div class="container">
                <h3>ReSharper DevGuide</h3>
                
        <div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1">
            <option data-group="primary" value="default" selected>Default</option>
            <option data-group="primary" value="default_for_gnome">GNOME</option>
            <option data-group="primary" value="default_for_kde">KDE</option>
            <option data-group="primary" value="default_for_xwin">XWindow</option>
            <option data-group="primary" value="emacs">Emacs</option>
            <option data-group="primary" value="jbuilder">JBuilder</option>
            <option data-group="primary" value="visual_studio">Visual Studio</option>
            <option data-group="primary" value="netbeans_6.5">NetBeans 6.5</option>
            <option data-group="primary" value="eclipse">Eclipse</option>
            <option data-group="secondary" value="mac_os_x_10.5_">OS X 10.5+</option>
            <option data-group="secondary" value="mac_os_x">OS X</option>
            <option data-group="secondary" value="eclipse_mac_os_x">OS X Eclipse</option></select>
        </div>
    
                <div class="panel-trigger"></div>
            </div>
        </header>
        <section class="panel__content">
            <div class="container">
                <article class="article" data-shortcut-switcher="false">

                    
                    <a name="navigation" class="elem-anchor"></a>
<h1>Navigation<a href="#navigation" class="anchor-link"><span></span></a></h1>

<p>ReSharper navigation consists of two main parts:</p>

<ul>
  <li>Context navigation (‘Navigate From Here…’)</li>
  <li>Global navigation (‘Go To …’)</li>
</ul>

<p>The navigation framework is fairly pluggable, so in most cases all you need to do is to simply provide your own components. You can implement the following features:</p>

<ul id="markdown-toc">
  <li><a href="#context-navigation" id="markdown-toc-context-navigation"><span>Context Navigation<a href="#context-navigation" class="anchor-link"><span></span></a></span></a></li>
  <li><a href="#feature-providers" id="markdown-toc-feature-providers"><span>Feature Providers<a href="#feature-providers" class="anchor-link"><span></span></a></span></a></li>
  <li><a href="#binding-to-an-action" id="markdown-toc-binding-to-an-action"><span>Binding to an action<a href="#binding-to-an-action" class="anchor-link"><span></span></a></span></a></li>
  <li><a href="#example" id="markdown-toc-example"><span>Example<a href="#example" class="anchor-link"><span></span></a></span></a></li>
  <li><a href="#context-searches" id="markdown-toc-context-searches"><span>Context Searches<a href="#context-searches" class="anchor-link"><span></span></a></span></a></li>
  <li><a href="#global-navigation-go-to-" id="markdown-toc-global-navigation-go-to-"><span>Global Navigation (‘Go To …’)<a href="#global-navigation-go-to-" class="anchor-link"><span></span></a></span></a></li>
  <li><a href="#occurrence-navigation-provider" id="markdown-toc-occurrence-navigation-provider"><span>Occurrence Navigation Provider<a href="#occurrence-navigation-provider" class="anchor-link"><span></span></a></span></a></li>
  <li><a href="#occurrence-presenter" id="markdown-toc-occurrence-presenter"><span>Occurrence Presenter<a href="#occurrence-presenter" class="anchor-link"><span></span></a></span></a></li>
  <li><a href="#occurrence-kind-provider" id="markdown-toc-occurrence-kind-provider"><span>Occurrence Kind Provider<a href="#occurrence-kind-provider" class="anchor-link"><span></span></a></span></a></li>
  <li><a href="#occurrence-section-provider" id="markdown-toc-occurrence-section-provider"><span>Occurrence Section Provider<a href="#occurrence-section-provider" class="anchor-link"><span></span></a></span></a></li>
  <li><a href="#tree-model" id="markdown-toc-tree-model"><span>Tree Model<a href="#tree-model" class="anchor-link"><span></span></a></span></a></li>
  <li><a href="#occurrence" id="markdown-toc-occurrence"><span>Occurrence<a href="#occurrence" class="anchor-link"><span></span></a></span></a></li>
</ul>

<a name="context-navigation" class="elem-anchor"></a>
<h2>Context Navigation<a href="#context-navigation" class="anchor-link"><span></span></a></h2>

<p>Context navigation consists of two parts: the searching engine and the user-interaction provider. These two parts are divided into different entities in ReSharper Framework.</p>

<a name="feature-providers" class="elem-anchor"></a>
<h2>Feature Providers<a href="#feature-providers" class="anchor-link"><span></span></a></h2>

<p>Feature providers represent features themselves. That is, there is just one provider per navigation feature regardless of the number of languages and environments where this feature is supposed to work.</p>

<p>Each context navigation provider implements either the <code class="code highlight language-text">IContextSearchProvider</code> or the <code class="code highlight language-text">INavigateFromHereProvider</code> interface. The <code class="code highlight language-text">IContextSearchProvider</code> interface is defined as follows:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IContextSearchProvider</span>
<span class="p">{</span>
<span class="na">  [CanBeNull]</span>
  <span class="n">Action</span> <span class="nf">GetSearchesExecution</span><span class="p">(</span><span class="n">IDataContext</span> <span class="n">dataContext</span><span class="p">,</span> <span class="n">INavigationExecutionHost</span> <span class="n">host</span><span class="p">);</span>
<span class="p">}</span></code></pre>

<p>The action that the <code class="code highlight language-text">GetSearchesExecution()</code> method returns is actually the execution of the navigation feature. When this method returns <code class="code highlight language-text">null</code>, it implies that this feature is not available for this data context. The <code class="code highlight language-text">INavigationExecutionHost</code> is a host object which can be used for performing certain UI activities, such as showing a drop-down box or the advanced search dialog.</p>

<p>The <code class="code highlight language-text">INavigateFromHere</code> interface is fairly similar to <code class="code highlight language-text">IContextSearchProvider</code> - it has just one method that returns navigation execution and additional data for presenting in the ‘Navigate From Here’ drop-down menu.</p>

<p>If you want your navigation items to appear in the ‘Navigate From Here’ menu, you have to implement the <code class="code highlight language-text">INavigateFromHereProvider</code> interface.</p>

<a name="binding-to-an-action" class="elem-anchor"></a>
<h2>Binding to an action<a href="#binding-to-an-action" class="anchor-link"><span></span></a></h2>

<p>You don’t need to write any code in your action handler’s methods, as all feature logic needs to be written inside navigation providers. All you need to bind your action to a navigation provider is to derive your custom action handler class from <code class="code highlight language-text">ContextNavigationActionBase&lt;TNavigateFromHereProvider&gt;</code> (if you want your action to appear in the ‘Navigate From Here’ menu) or <code class="code highlight language-text">ContextSearchActionBase&lt;TContextSearchProvider&gt;</code>.</p>

<p>Additionally, your provider should be decorated with the <code class="code highlight language-text">ContextNavigationProvider</code> attribute.</p>

<aside class="note">
  <p> If you want your feature to appear only in ‘Navigate From Here’ menu, you don’t even have to write an action - just implement <code class="code highlight language-text">ContextNavigationProvider</code> that implements <code class="code highlight language-text">INavigateFromHereProvider</code>.</p>
</aside>

<p>If your navigation is not complicated, that’s all you need to know about the context navigation framework.</p>

<a name="example" class="elem-anchor"></a>
<h2>Example<a href="#example" class="anchor-link"><span></span></a></h2>

<p>Here is an example of simple navigation to the corresponding folder using Windows explorer.</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Diagnostics</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">JetBrains.Annotations</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">JetBrains.Application.DataContext</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">JetBrains.ProjectModel</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">JetBrains.ReSharper.Feature.Services.ContextNavigation</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">JetBrains.Util</span><span class="p">;</span>

<span class="k">using</span> <span class="nn">DataConstants</span> <span class="p">=</span> <span class="n">JetBrains</span><span class="p">.</span><span class="n">ProjectModel</span><span class="p">.</span><span class="n">DataContext</span><span class="p">.</span><span class="n">DataConstants</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">ReSharperPlugIn6</span>
<span class="p">{</span>
<span class="na">  [ActionHandler]</span>
  <span class="k">public</span> <span class="k">class</span> <span class="nc">SimpleNavigation</span> <span class="p">:</span> <span class="n">ContextNavigationActionBase</span><span class="p">&lt;</span><span class="n">SimpleNavigationProvider</span><span class="p">&gt;</span>
  <span class="p">{</span>
  <span class="p">}</span>

<span class="na">  [ContextNavigationProvider]</span>
  <span class="k">public</span> <span class="k">class</span> <span class="nc">SimpleNavigationProvider</span> <span class="p">:</span> <span class="n">INavigateFromHereProvider</span>
  <span class="p">{</span>
<span class="na">    [CanBeNull]</span>
    <span class="k">private</span> <span class="k">static</span> <span class="n">ProcessStartInfo</span> <span class="nf">GetProcessStartInfo</span><span class="p">([</span><span class="n">NotNull</span><span class="p">]</span> <span class="n">FileSystemPath</span> <span class="n">path</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nf">ProcessStartInfo</span><span class="p">(</span><span class="s">&quot;explorer.exe&quot;</span><span class="p">,</span>
        <span class="n">path</span><span class="p">.</span><span class="n">ExistsFile</span> <span class="p">?</span> <span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">@&quot;/select,&quot;&quot;{0}&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="p">:</span> <span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">@&quot;&quot;&quot;{0}&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">.</span><span class="n">Directory</span><span class="p">));</span>
    <span class="p">}</span>

<span class="na">    [CanBeNull]</span>
    <span class="k">private</span> <span class="k">static</span> <span class="n">FileSystemPath</span> <span class="nf">GetPathByContext</span><span class="p">([</span><span class="n">NotNull</span><span class="p">]</span> <span class="n">IDataContext</span> <span class="n">context</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="kt">var</span> <span class="n">projectModelElement</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">GetData</span><span class="p">(</span><span class="n">DataConstants</span><span class="p">.</span><span class="n">PROJECT_MODEL_ELEMENT</span><span class="p">);</span>

      <span class="kt">var</span> <span class="n">projectItem</span> <span class="p">=</span> <span class="n">projectModelElement</span> <span class="k">as</span> <span class="n">IProjectItem</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">projectItem</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(!</span><span class="n">projectItem</span><span class="p">.</span><span class="n">Location</span><span class="p">.</span><span class="n">Directory</span><span class="p">.</span><span class="n">ExistsDirectory</span><span class="p">)</span>
        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>

      <span class="k">return</span> <span class="n">projectItem</span><span class="p">.</span><span class="n">Location</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">ContextNavigation</span><span class="p">&gt;</span> <span class="n">CreateWorkflow</span><span class="p">(</span><span class="n">IDataContext</span> <span class="n">dataContext</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="kt">var</span> <span class="n">path</span> <span class="p">=</span> <span class="n">GetPathByContext</span><span class="p">(</span><span class="n">dataContext</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">path</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="n">ProcessStartInfo</span> <span class="n">processStartInfo</span> <span class="p">=</span> <span class="n">GetProcessStartInfo</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">processStartInfo</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
          <span class="k">yield</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">ContextNavigation</span><span class="p">(</span> <span class="s">&quot;&amp;Windows Explorer&quot;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="n">NavigationActionGroup</span><span class="p">.</span><span class="n">Other</span><span class="p">,</span>
            <span class="p">()</span> <span class="p">=&gt;</span>
            <span class="p">{</span>
              <span class="k">try</span>
              <span class="p">{</span>
                <span class="k">using</span> <span class="p">(</span><span class="n">Process</span><span class="p">.</span><span class="n">Start</span><span class="p">(</span><span class="n">processStartInfo</span><span class="p">))</span> <span class="p">{</span> <span class="p">}</span>
              <span class="p">}</span>
              <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
              <span class="p">{</span>
                <span class="n">MessageBox</span><span class="p">.</span><span class="n">ShowError</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
              <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>

<a name="context-searches" class="elem-anchor"></a>
<h2>Context Searches<a href="#context-searches" class="anchor-link"><span></span></a></h2>

<p>If your navigation is complicated and works differently in different languages then you can use context searches to provide different search results for a specific language.</p>

<p>In this case, your provider needs to be derived from <code class="code highlight language-text">ContextSearchesCollector&lt;TContextSearch&gt;</code> class and all you need is to implement the <code class="code highlight language-text">Execute()</code> method.</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">protected</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Execute</span><span class="p">(</span><span class="n">IDataContext</span> <span class="n">dataContext</span><span class="p">,</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">TContextSearch</span><span class="p">&gt;</span> <span class="n">searches</span><span class="p">,</span> <span class="n">INavigationExecutionHost</span> <span class="n">host</span><span class="p">);</span></code></pre>

<p><code class="code highlight language-text">IContextSearch</code> is an interface for providers decorated with the <code class="code highlight language-text">FeaturePart</code> attribute and providing specific navigation execution. There are just two methods in this interface, indicating applicability and availability of said context search.</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IContextSearch</span>
<span class="p">{</span>
  <span class="kt">bool</span> <span class="nf">IsAvailable</span><span class="p">(</span><span class="n">IDataContext</span> <span class="n">dataContext</span><span class="p">);</span>
  <span class="kt">bool</span> <span class="nf">IsApplicable</span><span class="p">(</span><span class="n">IDataContext</span> <span class="n">dataContext</span><span class="p">);</span>
<span class="p">}</span></code></pre>

<p>The applicability method is more global and implies that this context search can work for this data context and will <em>override</em> other components it is derived from.</p>

<p>Availability means that for a specific data context this context search is enabled and will be fired.</p>

<p>You can alter the behavior of existing ReSharper navigation features by providing your own context search components. Here is an example of a  context search that extends the ‘Go To Implementation’ search for XAML:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="na">[FeaturePart]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">XamlImplementationContextSearch</span> <span class="p">:</span> <span class="n">ContextNavigation</span><span class="p">.</span><span class="n">ContextSearches</span><span class="p">.</span><span class="n">BaseSearches</span><span class="p">.</span><span class="n">ImplementationContextSearch</span>
<span class="p">{</span>
  <span class="k">protected</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">IsAvailable</span><span class="p">(</span><span class="n">IDataContext</span> <span class="n">dataContext</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">IsApplicable</span><span class="p">(</span><span class="n">IDataContext</span> <span class="n">dataContext</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="n">ContextNavigationUtil</span><span class="p">.</span><span class="n">CheckDefaultApplicability</span><span class="p">&lt;</span><span class="n">XamlLanguage</span><span class="p">&gt;(</span><span class="n">dataContext</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">protected</span> <span class="k">override</span> <span class="n">SearchImplementationsRequest</span> <span class="nf">CreateSearchRequest</span><span class="p">(</span><span class="n">IDataContext</span> <span class="n">dataContext</span><span class="p">,</span> <span class="n">IDeclaredElement</span> <span class="n">declaredElement</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="c1">// Your custom logic here...</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>

<a name="global-navigation-go-to-" class="elem-anchor"></a>
<h2>Global Navigation (‘Go To …’)<a href="#global-navigation-go-to-" class="anchor-link"><span></span></a></h2>

<p><em>Global nagivation</em> relates to functionality used in various global searches such as <em>Go To Type</em> or <em>Go To Member</em>. Typically, these searches all function as a text-entry popup box that, when typed into, presents a list that can be further refined and then, upon selection, navigated to the declared element. In addition, lists can ‘morph’ so that a Go To Type search can suddenly become a Go To Symbol search with the press of one shortcut.</p>

<a name="occurrence-navigation-provider" class="elem-anchor"></a>
<h2>Occurrence Navigation Provider<a href="#occurrence-navigation-provider" class="anchor-link"><span></span></a></h2>

<p>In order to provide items for a particular global navigation mechanic, we need to implement an occurrence navigation provider - a class that implements the <code class="code highlight language-text">IOccurenceNavigationProvider</code> interface. The following image illustrates the hierarchy of this interface:</p>

<p><img src="navigation.png" alt="IOccurenceNavigationProvider hierarchy" /></p>

<p>As you can see, the four interface members are self-descriptive, and are further implemented by concrete classes based on language. For example, <code class="code highlight language-text">IGotoSymbolProvider</code> has concrete implementations for the CLR, CSS, HTML and JavaScript. This interface is also implemented by the <code class="code highlight language-text">ClrGotoTypeMemberProvider</code>, which illustrates a kind of inheritance mechanic - this makes sense because Go To Symbol actually includes information from Go To Type.</p>

<p>The interface is fairly simple, and has only three members:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IOccurenceNavigationProvider</span> <span class="p">:</span> <span class="n">IApplicableGotoProvider</span>
<span class="p">{</span>
  <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">MatchingInfo</span><span class="p">&gt;</span> <span class="n">FindMatchingInfos</span><span class="p">(</span><span class="n">IdentifierMatcher</span> <span class="n">matcher</span><span class="p">,</span> <span class="n">INavigationScope</span> <span class="n">scope</span><span class="p">,</span>
                                              <span class="n">CheckForInterrupt</span> <span class="n">checkCancelled</span><span class="p">,</span> <span class="n">GotoContext</span> <span class="n">gotoContext</span><span class="p">);</span>
  <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">IOccurence</span><span class="p">&gt;</span> <span class="n">GetOccurencesByMatchingInfo</span><span class="p">(</span><span class="n">MatchingInfo</span> <span class="n">navigationInfo</span><span class="p">,</span> <span class="n">INavigationScope</span> <span class="n">scope</span><span class="p">,</span> <span class="n">GotoContext</span> <span class="n">gotoContext</span><span class="p">);</span>
<span class="p">}</span></code></pre>

<p>The first method, <code class="code highlight language-text">FindMatchingInfos()</code>, find matched items and returns a corresponding list of <code class="code highlight language-text">MatchingInfo</code> objects. A <code class="code highlight language-text">MatchingInfo</code> is simply a data class that describes the necessary info used to store a matching item - its identifier, a set of <code class="code highlight language-text">IdentifierMatch</code> objects (corresponding to the matches, as there can be many) and some other service information.</p>

<p>The second method, <code class="code highlight language-text">GetOccurencesByMatchingInfo</code>, returns a set of occurrences given the matching information. An <em>occurence</em> is essentially a pointer to the location where something was found. Since the definition of ‘something’ is quite vague, an occurrence can be practically anything - a range in a text editor, a project reference, a while project or a file. For example, a project file is represented by a <code class="code highlight language-text">ProjectItemOccurence</code>, which in turn references an <code class="code highlight language-text">IProjectItem</code> it points to.</p>

<p>In addition, you are required to implement an interface member inherited from <code class="code highlight language-text">IApplicableGotoProvider</code>:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IApplicableGotoProvider</span>
<span class="p">{</span>
  <span class="kt">bool</span> <span class="nf">IsApplicable</span><span class="p">(</span><span class="n">INavigationScope</span> <span class="n">scope</span><span class="p">,</span> <span class="n">GotoContext</span> <span class="n">gotoContext</span><span class="p">,</span> <span class="n">IdentifierMatcher</span> <span class="n">matcher</span><span class="p">);</span>
<span class="p">}</span></code></pre>

<p>The above method lets us determine if a particular provider should work in a given context. Providers can theoretically inherit from one another, and if you are overriding an existing provider, instead of working every single time (like a <code class="code highlight language-text">SolutionComponent</code> would), it instead checks the <code class="code highlight language-text">IsApplicable</code> result.</p>

<p>The API now provides you an interface called <code class="code highlight language-text">IGotoEverythingProvider</code>, which happens to inherit these two interfaces and in addition specifies a sorting function declared as</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="n">Func</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">&gt;</span> <span class="n">ItemsPriorityFunc</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span></code></pre>

<p>This interface lets you calculate a priority of the displayed element, such that the lower the result gets returned, the higher is the priority of the element.</p>

<p>Now, to create a provider, simply implement the interface and decorate the class with <code class="code highlight language-text">[ShellFeaturePart]</code>:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="na">[ShellFeaturePart]</span>
<span class="k">class</span> <span class="nc">GoToYouTrackIssueProvider</span> <span class="p">:</span> <span class="n">IGotoEverythingProvider</span>
<span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span></code></pre>

<a name="occurrence-presenter" class="elem-anchor"></a>
<h2>Occurrence Presenter<a href="#occurrence-presenter" class="anchor-link"><span></span></a></h2>

<p>Having a set of occurrences is great, but they’re useless until presented on-screen. And this is where occurrence presenters come in. An occurrence presenter is, basically, a class that knows how to present a particular occurrence as a menu item. In addition to being decorated by an <code class="code highlight language-text">OccurencePresenter</code> attribute, it is embodied by the <code class="code highlight language-text">IOccurencePresenter</code> interface defined below:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IOccurencePresenter</span>
<span class="p">{</span>
  <span class="kt">bool</span> <span class="nf">Present</span><span class="p">(</span><span class="n">IMenuItemDescriptor</span> <span class="n">descriptor</span><span class="p">,</span> <span class="n">IOccurence</span> <span class="n">occurence</span><span class="p">,</span>
    <span class="n">OccurencePresentationOptions</span> <span class="n">occurencePresentationOptions</span><span class="p">);</span>
  <span class="kt">bool</span> <span class="nf">IsApplicable</span><span class="p">(</span><span class="n">IOccurence</span> <span class="n">occurence</span><span class="p">);</span>
<span class="p">}</span></code></pre>

<p>First, there’s the <code class="code highlight language-text">IsApplicable()</code> method. This method determines whether this occurrence presenter is applicable for the particular type of occurrence. These typically go hand-in-hand, for example:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="na">[OccurencePresenter(Priority=0.0)]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">RangeOccurencePresenter</span> <span class="p">:</span> <span class="n">IOccurencePresenter</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">virtual</span> <span class="kt">bool</span> <span class="nf">IsApplicable</span><span class="p">(</span><span class="n">IOccurence</span> <span class="n">occurence</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="n">occurence</span> <span class="k">is</span> <span class="n">RangeOccurence</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// other members omitted</span>
<span class="p">}</span></code></pre>

<p>Then there’s the <code class="code highlight language-text">Present()</code> method, which is called when the <code class="code highlight language-text">IOccurence</code> needs to be presented. The goal of this method is to make assignments to the <code class="code highlight language-text">descriptor</code> parameter. The <code class="code highlight language-text">IMenuItemDescriptor</code> interface is quite large, but the only property we need to concern ourselves with here is <code class="code highlight language-text">Text</code> - this is a <code class="code highlight language-text">RichText</code> definition that will be displayed as a menu item for this occurrence.</p>

<p>Here’s a sample implementation. Note that <code class="code highlight language-text">descriptor.Style</code> <em>must</em> be defined - otherwise, the item will be disabled.</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">public</span> <span class="kt">bool</span> <span class="nf">Present</span><span class="p">(</span><span class="n">IMenuItemDescriptor</span> <span class="n">descriptor</span><span class="p">,</span> <span class="n">IOccurence</span> <span class="n">occurence</span><span class="p">,</span>
  <span class="n">OccurencePresentationOptions</span> <span class="n">occurencePresentationOptions</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">var</span> <span class="n">o</span> <span class="p">=</span> <span class="p">((</span><span class="n">YouTrackIssueOccurence</span><span class="p">)</span> <span class="n">occurence</span><span class="p">);</span>
  <span class="n">descriptor</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="n">o</span><span class="p">.</span><span class="n">IssueId</span><span class="p">;</span>
  <span class="n">descriptor</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">Append</span><span class="p">(</span><span class="s">&quot; - &quot;</span><span class="p">);</span>
  <span class="n">descriptor</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">Append</span><span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="n">IssueDescription</span><span class="p">);</span>
  <span class="n">descriptor</span><span class="p">.</span><span class="n">Style</span> <span class="p">=</span> <span class="n">MenuItemStyle</span><span class="p">.</span><span class="n">Enabled</span><span class="p">;</span>
  <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
<span class="p">}</span></code></pre>

<a name="occurrence-kind-provider" class="elem-anchor"></a>
<h2>Occurrence Kind Provider<a href="#occurrence-kind-provider" class="anchor-link"><span></span></a></h2>

<p>When you open up, say, Find Usages, you’ll find that you have an ability to filter information. Some examples are read usages, write usages, attribute references, and so on. Each has its own special icon and an ability to filter it out if necessary.</p>

<p>The types of elements just mentioned are called <em>occurence kinds</em>. Many kinds of occurrences can be found as static members of the <code class="code highlight language-text">OccurenceKind</code> class, and new ones can be created. An occurrence kind is simply an enum-like class, keeping only two bits of information: its name and whether it is primary or not. If the occurrence kind is set as primary, the Find Results window will always display this kind of occurrence regardless of what filter is set. Other occurrences are non-primary, i.e. they are only displayed when there are occurrences of this occurrence kind (e.g., unit tests).</p>

<p>Now, we can talk about occurrence type providers. These are typically solution components (i.e., decorated with the <code class="code highlight language-text">SolutionComponent</code> attributes) that also implement the <code class="code highlight language-text">IOccurenceKindProvider</code> interface. This interface is defined as follows:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IOccurenceKindProvider</span>
<span class="p">{</span>
  <span class="n">ICollection</span><span class="p">&lt;</span><span class="n">OccurenceKind</span><span class="p">&gt;</span> <span class="n">GetOccurenceKinds</span><span class="p">(</span><span class="n">IOccurence</span> <span class="n">occurence</span><span class="p">);</span>
  <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">OccurenceKind</span><span class="p">&gt;</span> <span class="n">GetAllPossibleOccurenceKinds</span><span class="p">();</span>
<span class="p">}</span></code></pre>

<p>The <code class="code highlight language-text">GetAllPossibleOccurenceKinds()</code> method returns a list of all possible occurrences that this provider can give in theory. For example, in C# we can yield interface qualifications, base method calls and invocations, whereas in VB we also have the <code class="code highlight language-text">Handles</code> clause.</p>

<p>The <code class="code highlight language-text">GetOccurenceKinds()</code> method returns a collection of occurrence kinds (or you can return an <code class="code highlight language-text">EmptyList&lt;OccurenceKind&gt;.InstanceList</code> if there aren’t any) that are applicable for a given occurrence. Naturally, this typically assumes that you would try to cast the <code class="code highlight language-text">IOccurence</code> to a concrete type (e.g., <code class="code highlight language-text">ReferenceOccurence</code>) to investigate its contents and yield the occurrence kinds accordingly.</p>

<a name="occurrence-section-provider" class="elem-anchor"></a>
<h2>Occurrence Section Provider<a href="#occurrence-section-provider" class="anchor-link"><span></span></a></h2>

<p>When search results are presented in a dialogue window, they are typically split into sections via horizontal lines. The component that provides information about the different types of section is a <code class="code highlight language-text">FeaturePart</code> that implements the <code class="code highlight language-text">IOccurenceSectionProvider</code> interface. The interface is defined as follows:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IOccurenceSectionProvider</span>
<span class="p">{</span>
  <span class="kt">bool</span> <span class="nf">IsApplicable</span><span class="p">(</span><span class="n">OccurenceBrowserDescriptor</span> <span class="n">descriptor</span><span class="p">);</span>
  <span class="n">ICollection</span><span class="p">&lt;</span><span class="n">TreeSection</span><span class="p">&gt;</span> <span class="n">GetTreeSections</span><span class="p">(</span><span class="n">OccurenceBrowserDescriptor</span> <span class="n">descriptor</span><span class="p">);</span>
  <span class="n">ICollection</span><span class="p">&lt;</span><span class="n">GroupingSectionId</span><span class="p">&gt;</span> <span class="n">GetGroupSectionId</span><span class="p">(</span><span class="n">IOccurence</span> <span class="n">occurence</span><span class="p">,</span> <span class="n">OccurenceBrowserDescriptor</span> <span class="n">descriptor</span><span class="p">);</span>
<span class="p">}</span></code></pre>

<p>Let’s go through the methods. Firstly, <code class="code highlight language-text">IsApplicable()</code> checks whether this section provider is applicable given the type of the occurrence browser we are working with. This is typically a simple <code class="code highlight language-text">is</code> call, e.g.:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">IsApplicable</span><span class="p">(</span><span class="n">OccurenceBrowserDescriptor</span> <span class="n">descriptor</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">descriptor</span> <span class="k">is</span> <span class="n">GotoDeclaredElementsBrowserDescriptor</span><span class="p">;</span>
<span class="p">}</span></code></pre>

<p>The second method is <code class="code highlight language-text">GetTreeSections()</code>, and it is this method that returns a set of <code class="code highlight language-text">TreeSection</code> objects specific to this section provider. We’ll discuss the <code class="code highlight language-text">TreeSection</code> structure in a moment, but let’s briefly discuss the third method first. <code class="code highlight language-text">GetGroupSectionId</code> basically lets us determine the groups (there can be more than one) in which a particular <code class="code highlight language-text">IOccurence</code> needs to appear. The default implementation as defined in the <code class="code highlight language-text">OccurenceSectionProvider</code> class (you should inherit from this, rather than implementing the interface by hand) is to use a special method <code class="code highlight language-text">GetSectionId()</code> to pick a known section given the type of the occurrence:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="c1">// in OccurenceSectionProvider</span>
<span class="k">public</span> <span class="k">virtual</span> <span class="n">ICollection</span><span class="p">&lt;</span><span class="n">GroupingSectionId</span><span class="p">&gt;</span> <span class="n">GetGroupSectionId</span><span class="p">(</span><span class="n">IOccurence</span> <span class="n">occurence</span><span class="p">,</span> <span class="n">OccurenceBrowserDescriptor</span> <span class="n">descriptor</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span><span class="p">[]</span> <span class="p">{</span><span class="n">occurence</span><span class="p">.</span><span class="n">OccurenceType</span><span class="p">.</span><span class="n">GetSectionId</span><span class="p">()};</span>
<span class="p">}</span></code></pre>

<a name="tree-model" class="elem-anchor"></a>
<h2>Tree Model<a href="#tree-model" class="anchor-link"><span></span></a></h2>

<p>Now, let’s go back and talk about <code class="code highlight language-text">TreeSection</code> definitions or, rather, about tree model, since the <code class="code highlight language-text">TreeSection</code> is nothing more than a container class for a title and a <code class="code highlight language-text">TreeModel</code> and it is this tree model that’s of interest to us.</p>

<p>A <code class="code highlight language-text">TreeModel</code>, as you may have guessed, is simply a definition for the classical N-ary tree. The model itself has itself a collection of roots, i.e. a property <code class="code highlight language-text">Roots</code> of type <code class="code highlight language-text">IList&lt;TreeModelNode&gt;</code> as well as various mechanisms for insertion, removal and updating of <code class="code highlight language-text">TreeModelNode</code> entities.</p>

<p>Each <code class="code highlight language-text">TreeModelNode</code> in turn has a set of children, who are also <code class="code highlight language-text">TreeModelNode</code> s themselves. Sorting is possible at both the <code class="code highlight language-text">TreeModel</code> and <code class="code highlight language-text">TreeModelNode</code> level. Note that the actual data storage inside the nodes is defined as an <code class="code highlight language-text">object</code>, i.e. is untyped.</p>

<p>It helps to remember that both <code class="code highlight language-text">TreeModel</code> and <code class="code highlight language-text">TreeModelNode</code> are abstract classes, and that you are more likely to be working with their descendants, the most basic of which is <code class="code highlight language-text">TreeSimpleModel</code>.</p>

<a name="occurrence" class="elem-anchor"></a>
<h2>Occurrence<a href="#occurrence" class="anchor-link"><span></span></a></h2>

<p>The menu items themselves are simply items which implement the <code class="code highlight language-text">IOccurence</code> interface. This interface defines a rather large number of elements:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IOccurence</span>
<span class="p">{</span>
  <span class="n">TextRange</span> <span class="n">TextRange</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">ProjectModelElementEnvoy</span> <span class="n">ProjectModelElementEnvoy</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">DeclaredElementEnvoy</span><span class="p">&lt;</span><span class="n">ITypeMember</span><span class="p">&gt;</span> <span class="n">TypeMember</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">DeclaredElementEnvoy</span><span class="p">&lt;</span><span class="n">ITypeElement</span><span class="p">&gt;</span> <span class="n">TypeElement</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">DeclaredElementEnvoy</span><span class="p">&lt;</span><span class="n">INamespace</span><span class="p">&gt;</span> <span class="n">Namespace</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">OccurenceType</span> <span class="n">OccurenceType</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
  <span class="kt">bool</span> <span class="n">IsValid</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
  <span class="kt">object</span> <span class="n">MergeKey</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">IList</span><span class="p">&lt;</span><span class="n">IOccurence</span><span class="p">&gt;</span> <span class="n">MergedItems</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">OccurencePresentationOptions</span> <span class="n">PresentationOptions</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
  <span class="kt">bool</span> <span class="nf">Navigate</span><span class="p">(</span><span class="n">ISolution</span> <span class="n">solution</span><span class="p">,</span> <span class="n">PopupWindowContextSource</span> <span class="n">windowContext</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">transferFocus</span><span class="p">,</span> <span class="n">TabOptions</span> <span class="n">tabOptions</span> <span class="p">=</span> <span class="n">TabOptions</span><span class="p">.</span><span class="n">Default</span><span class="p">);</span>
  <span class="kt">string</span> <span class="nf">DumpToString</span><span class="p">();</span>
<span class="p">}</span></code></pre>

<p>This interface is very feature-complete in terms of supporting, e.g., constructs which exist in code. In the case where you are providing ad hoc items not related to the PSI, you can provide the following defaults instead:</p>

<ul>
  <li><code class="code highlight language-text">DumpToString()</code> - up to you, this is a debugging method.</li>
  <li><code class="code highlight language-text">TextRange</code> - just return a <code class="code highlight language-text">new TextRange()</code>. You might want to consider making a single instance to return for each query.</li>
  <li><code class="code highlight language-text">MergeKey</code> - this yields a key which indicates whether or not several items should be merged. Thus, it makes sense to have this property yield a unique value for each item you don’t intend to merge.</li>
  <li><code class="code highlight language-text">ProjectElementEnvoy</code>, <code class="code highlight language-text">TypeMember</code>, <code class="code highlight language-text">TypeElement</code>, <code class="code highlight language-text">Namespace</code>, <code class="code highlight language-text">MergedItems</code> - simply return <code class="code highlight language-text">null</code>.</li>
  <li><code class="code highlight language-text">OccurenceType</code> - <code class="code highlight language-text">OccurenceType.Occurence</code>.</li>
  <li><code class="code highlight language-text">IsValid</code> - <code class="code highlight language-text">true</code>.</li>
  <li><code class="code highlight language-text">PresentationOption</code> - define it as a <code class="code highlight language-text">get/set</code> property.</li>
</ul>

<p>For examples of leveraging the various <code class="code highlight language-text">IOccurence</code> members, take a look at some of the its built-in ReSharper implementors.</p>



                    <div class="last-modified">
                        Last modified: 8 May 2015
                    </div>
                </article>

                <section class="disqus">
                    <div id="disqus_thread"></div>
                </section>
            </div>
        </section>
    </main>
</div>


<script data-main="/resharper-devguide/app/js/main.build" data-baseurl="/resharper-devguide/" src="/resharper-devguide/app/js/vendor/requirejs/require.js"></script>

</body>
</html>

