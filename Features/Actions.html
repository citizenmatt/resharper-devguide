


<!doctype html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title> / ReSharper  DevGuide</title>
    <link rel="stylesheet" href="/resharper-devguide/app/css/styles.min.css">
<link  rel="stylesheet" href="/resharper-devguide/styles/styles.css"></head>
<body data-id="Features/Actions">
<div class="wrapper">
    <section class="panel _nav">
        <header class="panel__header">
            <div class="container">
                <form class="search-box">
                    <label for="search-box__input" class="search-box__label">
                        <input type="text" class="search-box__input" id="search-box__input" placeholder="Search ReSharper  DevGuide">
                    </label>
                    <div class="search-box__clear" title="Clear"></div>
                </form>
            </div>
        </header>
        <nav class="panel__content">
            <div class="container _nav">
                <menu class="nav-tree"></menu>
            </div>
            <div class="container _footer panel__footer">
                <p><a href="mailto:feedback@jetbrains.com">Send feedback</a></p>
                <p>&copy; 2000&ndash;2015 <a href="//www.jetbrains.com">JetBrains</a> s.r.o.<br>
                    All rights reserved.</p>
            </div>
        </nav>
    </section>

    <main class="panel _main" role="main">
        <header class="panel__header">
            <div class="container">
                <h3>ReSharper DevGuide</h3>
                
        <div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1">
            <option data-group="primary" value="default" selected>Default</option>
            <option data-group="primary" value="default_for_gnome">GNOME</option>
            <option data-group="primary" value="default_for_kde">KDE</option>
            <option data-group="primary" value="default_for_xwin">XWindow</option>
            <option data-group="primary" value="emacs">Emacs</option>
            <option data-group="primary" value="jbuilder">JBuilder</option>
            <option data-group="primary" value="visual_studio">Visual Studio</option>
            <option data-group="primary" value="netbeans_6.5">NetBeans 6.5</option>
            <option data-group="primary" value="eclipse">Eclipse</option>
            <option data-group="secondary" value="mac_os_x_10.5_">OS X 10.5+</option>
            <option data-group="secondary" value="mac_os_x">OS X</option>
            <option data-group="secondary" value="eclipse_mac_os_x">OS X Eclipse</option></select>
        </div>
    
                <div class="panel-trigger"></div>
            </div>
        </header>
        <section class="panel__content">
            <div class="container">
                <article class="article" data-shortcut-switcher="false">

                    
                    <a name="actions-and-menu-items" class="elem-anchor"></a>
<h1>Actions and Menu Items<a href="#actions-and-menu-items" class="anchor-link"><span></span></a></h1>

<aside class="warning">
  <p> This topic relates to ReSharper 8, and has not been updated to ReSharper 9 or the ReSharper Platform.</p>
</aside>

<p>While the bulk of ReSharper is concerned with presenting its own types of UI (popups, dialog windows, etc.), certain features can be implemented using traditional menu items that would be familiar to anyone who has done Visual Studio plugin development. A menu item subsequently triggers an <em>action</em>, i.e. a unit of work associated with this menu item.</p>

<a name="when-to-create-actions" class="elem-anchor"></a>
<h2>When to create Actions<a href="#when-to-create-actions" class="anchor-link"><span></span></a></h2>

<p>There are essentially two use cases for creating Actions.</p>

<p>The first use case is when you want to expose a particular ReSharper feature, such as e.g., a Context Action, as a Visual Studio command that can be bound to a shortcut. The relevance of this depends on the feature.</p>

<p>The second use case would be a situation where you want your action to do things unrelated to the ReSharper infrastructure. Examples of such actions would be an action to show an About dialog box, to open up a Help File for your plugin, or fire up some other process.</p>

<p>Both of these use cases are accommodated by the Action subsystem.</p>

<a name="making-actions" class="elem-anchor"></a>
<h2>Making actions<a href="#making-actions" class="anchor-link"><span></span></a></h2>

<p>In order to add your own menu items to the infrastructure, you need to do the following things:</p>

<ul>
  <li>Create an <code class="code highlight language-text">Actions.xml</code> file which will contain definitions of actions and the places where to insert them.</li>
  <li>Ensure the <code class="code highlight language-text">Actions.xml</code> file is embedded as a resource in your assembly</li>
  <li>Ensure that the assembly has an ActionsXml attribute pointing to the above file.</li>
  <li>Define action handlers for the actions.</li>
</ul>

<p>Let’s take a look at these steps in turn.</p>

<a name="actionsxml" class="elem-anchor"></a>
<h2>Actions.xml<a href="#actionsxml" class="anchor-link"><span></span></a></h2>

<p><code class="code highlight language-text">Actions.xml</code> is an embedded resource you can keep in your project. ReSharper is able to locate the resource due to the ActionsXml attribute with which the assembly is decorated. For example:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="na">[assembly: ActionsXml(&quot;JetBrains.ReSharper.PowerToys.MenuItem.Actions.xml&quot;)]</span></code></pre>

<aside class="note">
  <p>: This attribute is no longer required in ReSharper 8. ReSharper will instead look for all embedded resources in an assembly to see if it matches the name <code class="code highlight language-text">Actions.xml</code></p>
</aside>

<p>The XML file itself is fairly simple. At the root level, it uses the <code class="code highlight language-text">actions</code> element. Within it, there are several different types of content.</p>

<p>One mandatory type of content is action elements, which indicate the ID of the action concerned, the text that gets displayed, and (optionally) an image. The image can be, e.g., a 16x16 pixel GIF stored as an embedded resource.</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_xml"><span class="nt">&lt;action</span> <span class="na">id=</span><span class="s">&quot;AddMenuItem.ShowCurrentSolution&quot;</span> <span class="na">text=</span><span class="s">&quot;Show Current Solution&quot;</span>
        <span class="na">image=</span><span class="s">&quot;JetBrains.ReSharper.PowerToys.MenuItem.testImage.gif&quot;</span> <span class="nt">/&gt;</span></code></pre>

<p>This is the way actions are defined, but how are they inserted into existing menus? This is what the insert element is for. In this element, you specify the Group ID where the items are inserted, as well as the position they are inserted in (e.g., “last”).</p>

<p>When specifying the group ID, you can specify</p>

<ul>
  <li>A ReSharper menu (e.g., “ReSharper.Navigate”)</li>
  <li>A Visual Studio menu (e.g., “VS#Solution”)</li>
</ul>

<p>For Visual Studio, the part following VS# is the path in the command bar structure of VS itself. You can also use the menu CommandID for this, in the form “VS#(GUID:ID)”.</p>

<p>Consequently, to insert a separator and the ShowCurrentLineNumber action into the VS code window, you would add the following:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_xml"><span class="nt">&lt;insert</span> <span class="na">group-id=</span><span class="s">&quot;VS#Code Window&quot;</span> <span class="na">position=</span><span class="s">&quot;last&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;separator</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;action-ref</span> <span class="na">id=</span><span class="s">&quot;AddMenuItem.ShowCurrentLineNumber&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/insert&gt;</span></code></pre>

<a name="action-handlers" class="elem-anchor"></a>
<h2>Action Handlers<a href="#action-handlers" class="anchor-link"><span></span></a></h2>

<p>An action handler is the piece of code that handles an action. It is simply a class decorated by the <code class="code highlight language-text">IActionHandler</code> interface and implementing the <code class="code highlight language-text">IActionHandler</code> interface.</p>

<p>Now, you’re probably wondering - how is the action handler bound to an action? Well, there are two ways to do this. One is to name the class file to match the action, such that an action of <code class="code highlight language-text">AddMenuItem.ShowCurrentSolution</code> matches the class name of <code class="code highlight language-text">AddMenuItem_ShowCurrentSolutionAction</code>. As you may have guessed, underscores get ‘turned’ into dots, and suffixes such as <code class="code highlight language-text">Action</code> or <code class="code highlight language-text">ActionHandler</code> are removed.</p>

<p>Concerning the <code class="code highlight language-text">IActionHandler</code> interface, it requires that you implement two methods.</p>

<p>The first - <code class="code highlight language-text">Update()</code> - returns a boolean value indicating whether the menu item is enabled or disabled. For example, if your action needs a solution to work on, you could specify the following Update() method:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">public</span> <span class="kt">bool</span> <span class="nf">Update</span><span class="p">(</span><span class="n">IDataContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">ActionPresentation</span> <span class="n">presentation</span><span class="p">,</span> <span class="n">DelegateUpdate</span> <span class="n">nextUpdate</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// fetch active solution from context</span>
  <span class="n">ISolution</span> <span class="n">solution</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">GetData</span><span class="p">(</span><span class="n">JetBrains</span><span class="p">.</span><span class="n">ProjectModel</span><span class="p">.</span><span class="n">DataContext</span><span class="p">.</span><span class="n">DataConstants</span><span class="p">.</span><span class="n">SOLUTION</span><span class="p">);</span>

  <span class="c1">// enable this action if there is an active solution, disable otherwise</span>
  <span class="k">return</span> <span class="n">solution</span> <span class="p">!=</span> <span class="k">null</span><span class="p">;</span>
<span class="p">}</span></code></pre>

<p>The second method is called <code class="code highlight language-text">Execute()</code>. This is the method where the action is actually executed.</p>

<a name="redefining-action-handlers" class="elem-anchor"></a>
<h2>Redefining Action Handlers<a href="#redefining-action-handlers" class="anchor-link"><span></span></a></h2>

<p>If you wish to override existing actions, you can create a custom shell component that finds an existing action and adds a different handler for it. For example, here is a custom action handler override for the <code class="code highlight language-text">TypeHierarchy.ClassHierarchy</code> action:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="na">[ShellComponent]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">CustomActionHandlerManager</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="nf">CustomActionHandlerManager</span><span class="p">(</span><span class="n">Lifetime</span> <span class="n">lifetime</span><span class="p">,</span> <span class="n">IActionManager</span> <span class="n">actionManager</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="kt">var</span> <span class="n">classHierarchy</span> <span class="p">=</span> <span class="n">actionManager</span><span class="p">.</span><span class="n">GetUpdatableAction</span><span class="p">(</span><span class="s">&quot;TypeHierarchy.ClassHierarchy&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">classHierarchy</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
      <span class="n">classHierarchy</span><span class="p">.</span><span class="n">AddHandler</span><span class="p">(</span><span class="n">lifetime</span><span class="p">,</span> <span class="k">new</span> <span class="n">WholeMembersHierarchyActions</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>



                    <div class="last-modified">
                        Last modified: 8 May 2015
                    </div>
                </article>

                <section class="disqus">
                    <div id="disqus_thread"></div>
                </section>
            </div>
        </section>
    </main>
</div>


<script data-main="/resharper-devguide/app/js/main.build" data-baseurl="/resharper-devguide/" src="/resharper-devguide/app/js/vendor/requirejs/require.js"></script>

</body>
</html>

