


<!doctype html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title> / ReSharper  DevGuide</title>
    <link rel="stylesheet" href="/resharper/devguide/app/css/styles.min.css">
<link  rel="stylesheet" href="/resharper/devguide/styles/styles.css"></head>
<body data-id="PSI/References/PathReferences">
<div class="wrapper">
    <section class="panel _nav">
        <header class="panel__header">
            <div class="container">
                <form class="search-box">
                    <label for="search-box__input" class="search-box__label">
                        <input type="text" class="search-box__input" id="search-box__input" placeholder="Search ReSharper  DevGuide">
                    </label>
                    <div class="search-box__clear" title="Clear"></div>
                </form>
            </div>
        </header>
        <nav class="panel__content">
            <div class="container _nav">
                <menu class="nav-tree"></menu>
            </div>
            <div class="container _footer panel__footer">
                <p><a href="mailto:feedback@jetbrains.com">Send feedback</a></p>
                <p>&copy; 2000&ndash;2015 <a href="//www.jetbrains.com">JetBrains</a> s.r.o.<br>
                    All rights reserved.</p>
            </div>
        </nav>
    </section>

    <main class="panel _main" role="main">
        <header class="panel__header">
            <div class="container">
                <h3>ReSharper DevGuide</h3>
                
        <div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1">
            <option data-group="primary" value="default" selected>Default</option>
            <option data-group="primary" value="default_for_gnome">GNOME</option>
            <option data-group="primary" value="default_for_kde">KDE</option>
            <option data-group="primary" value="default_for_xwin">XWindow</option>
            <option data-group="primary" value="emacs">Emacs</option>
            <option data-group="primary" value="jbuilder">JBuilder</option>
            <option data-group="primary" value="visual_studio">Visual Studio</option>
            <option data-group="primary" value="netbeans_6.5">NetBeans 6.5</option>
            <option data-group="primary" value="eclipse">Eclipse</option>
            <option data-group="secondary" value="mac_os_x_10.5_">OS X 10.5+</option>
            <option data-group="secondary" value="mac_os_x">OS X</option>
            <option data-group="secondary" value="eclipse_mac_os_x">OS X Eclipse</option></select>
        </div>
    
                <div class="panel-trigger"></div>
            </div>
        </header>
        <section class="panel__content">
            <div class="container">
                <article class="article" data-shortcut-switcher="false">

                    
                    <a name="path-references" class="elem-anchor"></a>
<h1>Path references<a href="#path-references" class="anchor-link"><span></span></a></h1>

<p>ReSharper supports path references, which are references that target file system paths. They implement <code class="code highlight language-text">IPathReference</code> or <code class="code highlight language-text">IFileReference</code>, which both inherit from <code class="code highlight language-text">IReference</code> and typically apply to a substring within a string literal. Hitting Ctrl+Click on a path reference will navigate to that file or folder, and renaming a path (as long as it’s part of the Visual Studio project) will be reflected in the string associated with the reference.</p>

<p>Path references are also “qualified” references. That is, the reference has a qualifier, which is the previous part of the path. The value of these qualifiers are available via the <code class="code highlight language-text">IQualifiableReferenceBase</code> and <code class="code highlight language-text">IReferenceWithQualifier</code> interfaces, which inherit from <code class="code highlight language-text">IReference</code> and are implemented by the path reference. The qualifiers themselves implement <code class="code highlight language-text">IQualifier</code>, and are used during when the reference is resolved. (Note that qualified references are not necessarily file path references. For example, ASP.NET support has data binding references where each segment of the reference uses the previous segment’s reference as a qualifier.)</p>

<a name="creating-path-references" class="elem-anchor"></a>
<h2>Creating path references<a href="#creating-path-references" class="anchor-link"><span></span></a></h2>

<p>There are several helper classes for creating file and folder references, depending on the language of the underlying document. The <code class="code highlight language-text">PathReferenceUtil.CreatePathReferences</code> static method will parse a path string and generate references for the folder and file segments.</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">public</span> <span class="k">static</span> <span class="n">IPathReference</span><span class="p">[]</span> <span class="n">CreatePathReferences</span><span class="p">&lt;</span><span class="n">TOwner</span><span class="p">,</span><span class="n">TToken</span><span class="p">&gt;(</span>
  <span class="n">TOwner</span> <span class="n">owner</span><span class="p">,</span> <span class="n">TToken</span> <span class="n">token</span><span class="p">,</span> <span class="n">IQualifier</span> <span class="n">baseQualifier</span><span class="p">,</span>
  <span class="n">Func</span><span class="p">&lt;</span><span class="n">TOwner</span><span class="p">,</span> <span class="n">IQualifier</span><span class="p">,</span> <span class="n">TToken</span><span class="p">,</span> <span class="n">TreeTextRange</span><span class="p">,</span> <span class="n">IPathReference</span><span class="p">&gt;</span> <span class="n">createFolderReferenceDelegate</span><span class="p">,</span>
  <span class="n">Func</span><span class="p">&lt;</span><span class="n">TOwner</span><span class="p">,</span> <span class="n">IQualifier</span><span class="p">,</span> <span class="n">TToken</span><span class="p">,</span> <span class="n">TreeTextRange</span><span class="p">,</span> <span class="n">IPathReference</span><span class="p">&gt;</span> <span class="n">createFileReferenceDelegate</span><span class="p">,</span>
  <span class="n">Func</span><span class="p">&lt;</span><span class="n">TToken</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">getStringValueDelegate</span><span class="p">,</span>
  <span class="n">Func</span><span class="p">&lt;</span><span class="n">TToken</span><span class="p">,</span> <span class="kt">int</span><span class="p">&gt;</span> <span class="n">getValueStartOffset</span>
<span class="p">)</span>
  <span class="k">where</span> <span class="n">TOwner</span> <span class="p">:</span> <span class="n">ITreeNode</span>
  <span class="k">where</span> <span class="n">TToken</span> <span class="p">:</span> <span class="n">class</span><span class="p">,</span> <span class="n">ITreeNode</span>
<span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span></code></pre>

<p>The parameters are as follows:</p>

<ul>
  <li><strong><code class="code highlight language-text">owner</code></strong> and <strong><code class="code highlight language-text">token</code></strong> are two <code class="code highlight language-text">ITreeNode</code> instances that represent the owner of the references, and the token that contains the path. These are not necessarily the same tree node. For example, an HTML attribute would own the references, but it’s the string literal token part of the attribute that is used to get the path string.</li>
  <li><strong><code class="code highlight language-text">baseQualifier</code></strong> represents the part of the path that this current path is relative to. It might be a root part of the path, or an implied reference. (e.g. <code class="code highlight language-text">~</code> in a web site implies the root of the project, and the string path is relative to the root of the project)</li>
  <li><strong><code class="code highlight language-text">createFolderReferenceDelegate</code></strong> and <strong><code class="code highlight language-text">createFileReferenceDelegate</code></strong> are two functions that are called to create a folder and file reference, respectively. The parameters to these functions are:
    <ul>
      <li>the <code class="code highlight language-text">ITreeNode</code> that will own the references</li>
      <li>the qualifier of this path segment</li>
      <li>the token that provides the string</li>
      <li>the <code class="code highlight language-text">TreeTextRange</code> of the path segment inside the token, relative to the start of the PSI tree, not the token.</li>
    </ul>

    <p>The functions should create an instance of <code class="code highlight language-text">IPathReference</code>, or return null. If the reference also implements <code class="code highlight language-text">IQualifier</code>, it is passed to the creation function as the qualifier for the next path segment.</p>
  </li>
  <li><strong><code class="code highlight language-text">getStringValueDelegate</code></strong> and <strong><code class="code highlight language-text">getValueStartOffset</code></strong> are used to get the string value of the whole path to parse from the token, and the start offset within the token of the path.</li>
</ul>

<p>The <code class="code highlight language-text">CreatePathReferences</code> method will first try to parse the path as a URI. If it is a valid, absolute URI, the path references are retrieved by iterating through all <code class="code highlight language-text">IUriPathResolver</code> solution components until one returns a non-null value. The list of components are in an arbitrary order, and ReSharper only provides a single implementation - <code class="code highlight language-text">SdkReferenceContentFilePathResolver</code>, which looks for <code class="code highlight language-text">ms-appx://</code> Windows Store App SDK references. It will create a reference for the first path segment, then call back into <code class="code highlight language-text">PathReferenceUtil.CreatePathReferences</code> method to parse the rest of the path, passing the first path segment’s reference as the base qualifier. If no <code class="code highlight language-text">IUriPathResolver</code> components handle the URI, no references are created for it.</p>

<p>Assuming the path isn’t a valid, absolute URI, it is then split into path segments based on the directory char separators <code class="code highlight language-text">\</code> and <code class="code highlight language-text">/</code>. All segments apart from the last are passed to <code class="code highlight language-text">createFolderReferenceDelegate</code>. If the delegate creates a reference, it is checked for <code class="code highlight language-text">IQualifier</code> and used as the qualifier for the next path segment. The delegate can also return null, in which case, no reference is created for this path segment. The first path segment receives the <code class="code highlight language-text">baseQualifier</code> parameter, unless it matches the <code class="code highlight language-text">~</code> string, in which case the qualifier is set to <code class="code highlight language-text">null</code>.</p>

<p>The last path segment is passed to <code class="code highlight language-text">createFileReferenceDelegate</code>, unless it matches <code class="code highlight language-text">~</code>, <code class="code highlight language-text">.</code> or <code class="code highlight language-text">..</code> in which case it’s assumed to be a folder, and is passed to <code class="code highlight language-text">createFolderReferenceDelegate</code>.</p>

<a name="html-and-html-like-languages" class="elem-anchor"></a>
<h2>HTML and HTML-like languages<a href="#html-and-html-like-languages" class="anchor-link"><span></span></a></h2>

<p>The <code class="code highlight language-text">HtmlPathReferenceUtil</code> provides wrapper methods for <code class="code highlight language-text">PathReferenceUtil.CreatePathReferences</code> for HTML and HTML-like languages (ASPX, Razor, etc.). The <code class="code highlight language-text">CreatePathReferences</code> method is a simple pass through, but the <code class="code highlight language-text">CreatePathAndIdReferences</code> method will use <code class="code highlight language-text">PathReferenceUtil.CreatePathReferences</code> to create the file and folder references, and create an additional reference for the #-fragment of the URL, pointing to a HTML element based on its ID.</p>

<p>The HTML languages also provide their own implementations of the reference classes, with individual knowledge of the language they are supporting. They all derive from <code class="code highlight language-text">PathReferenceBase</code> or <code class="code highlight language-text">HtmlFileReference</code> or <code class="code highlight language-text">HtmlFolderReference</code>.</p>

<p>If you’re not working with HTML or HTML-like languages, and <code class="code highlight language-text">PathReferenceBase</code> isn’t appropriate to derive from, you can derive from <code class="code highlight language-text">QualifiableReferenceWithinElement</code> to provide a base implementation of <code class="code highlight language-text">IReferenceWithQualifier</code>.</p>



                    <div class="last-modified">
                        Last modified: 8 May 2015
                    </div>
                </article>

                <section class="disqus">
                    <div id="disqus_thread"></div>
                </section>
            </div>
        </section>
    </main>
</div>


<script data-main="/resharper/devguide/app/js/main.build" data-baseurl="/resharper/devguide/" src="/resharper/devguide/app/js/vendor/requirejs/require.js"></script>

</body>
</html>

