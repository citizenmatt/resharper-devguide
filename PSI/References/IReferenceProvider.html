


<!doctype html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title> / ReSharper  DevGuide</title>
    <link rel="stylesheet" href="/resharper/devguide/app/css/styles.min.css">
<link  rel="stylesheet" href="/resharper/devguide/styles/styles.css"></head>
<body data-id="PSI/References/IReferenceProvider">
<div class="wrapper">
    <section class="panel _nav">
        <header class="panel__header">
            <div class="container">
                <form class="search-box">
                    <label for="search-box__input" class="search-box__label">
                        <input type="text" class="search-box__input" id="search-box__input" placeholder="Search ReSharper  DevGuide">
                    </label>
                    <div class="search-box__clear" title="Clear"></div>
                </form>
            </div>
        </header>
        <nav class="panel__content">
            <div class="container _nav">
                <menu class="nav-tree"></menu>
            </div>
            <div class="container _footer panel__footer">
                <p><a href="mailto:feedback@jetbrains.com">Send feedback</a></p>
                <p>&copy; 2000&ndash;2015 <a href="//www.jetbrains.com">JetBrains</a> s.r.o.<br>
                    All rights reserved.</p>
            </div>
        </nav>
    </section>

    <main class="panel _main" role="main">
        <header class="panel__header">
            <div class="container">
                <h3>ReSharper DevGuide</h3>
                
        <div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1">
            <option data-group="primary" value="default" selected>Default</option>
            <option data-group="primary" value="default_for_gnome">GNOME</option>
            <option data-group="primary" value="default_for_kde">KDE</option>
            <option data-group="primary" value="default_for_xwin">XWindow</option>
            <option data-group="primary" value="emacs">Emacs</option>
            <option data-group="primary" value="jbuilder">JBuilder</option>
            <option data-group="primary" value="visual_studio">Visual Studio</option>
            <option data-group="primary" value="netbeans_6.5">NetBeans 6.5</option>
            <option data-group="primary" value="eclipse">Eclipse</option>
            <option data-group="secondary" value="mac_os_x_10.5_">OS X 10.5+</option>
            <option data-group="secondary" value="mac_os_x">OS X</option>
            <option data-group="secondary" value="eclipse_mac_os_x">OS X Eclipse</option></select>
        </div>
    
                <div class="panel-trigger"></div>
            </div>
        </header>
        <section class="panel__content">
            <div class="container">
                <article class="article" data-shortcut-switcher="false">

                    
                    <a name="managing-reference-providers" class="elem-anchor"></a>
<h1>Managing reference providers<a href="#managing-reference-providers" class="anchor-link"><span></span></a></h1>

<p>To build a reference provider, you implement <code class="code highlight language-text">IReferenceProviderFactory</code>, <code class="code highlight language-text">IReferenceFactory</code> and <code class="code highlight language-text">IReference</code>. It is very easy to get these mixed up with the <code class="code highlight language-text">ReferenceProviderFactory</code> class and the <code class="code highlight language-text">IReferenceProvider</code> interface, however, they serve different purposes. <code class="code highlight language-text">ReferenceProviderFactory</code> and <code class="code highlight language-text">IReferenceProvider</code> are facades that manage the responsibility of delegating and aggregating the creation of custom references to multiple custom reference providers.</p>

<p>The <code class="code highlight language-text">ReferenceProviderFactory</code> class hides the complexity of maintaining a large collection of custom reference providers. It is a <code class="code highlight language-text">[PsiComponent]</code> that maintains an <code class="code highlight language-text">IViewable&lt;IReferenceProviderFactory&gt;</code>. It has one public method:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">ReferenceProviderFactory</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="n">IReferenceProvider</span> <span class="nf">Create</span><span class="p">(</span><span class="n">IPsiSourceFile</span> <span class="n">sourceFile</span><span class="p">,</span> <span class="n">IFile</span> <span class="n">file</span><span class="p">);</span>
<span class="p">}</span></code></pre>

<p>This method iterates over the collection of custom reference providers and calls <code class="code highlight language-text">IReferenceProviderFactory.CreateFactory</code> on each, maintaining a list of the returned <code class="code highlight language-text">IReferenceFactory</code> instances. It then returns a custom instance of <code class="code highlight language-text">IReferenceProvider</code> that is based on this list of custom reference factories.</p>

<p>The <code class="code highlight language-text">IReferenceProvider</code> interface is very similar to the <code class="code highlight language-text">IReferenceFactory</code> interface:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IReferenceProvider</span>
<span class="p">{</span>
  <span class="n">ReferenceCollection</span> <span class="nf">GetReferences</span><span class="p">(</span><span class="n">ITreeNode</span> <span class="n">element</span><span class="p">,</span> <span class="n">ICollection</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">names</span><span class="p">);</span>
  <span class="kt">bool</span> <span class="nf">ContainsReference</span><span class="p">(</span><span class="n">ITreeNode</span> <span class="n">element</span><span class="p">,</span> <span class="n">IReference</span> <span class="n">reference</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">interface</span> <span class="n">IReferenceFactory</span>
<span class="p">{</span>
  <span class="n">IReference</span><span class="p">[]</span> <span class="nf">GetReferences</span><span class="p">(</span><span class="n">ITreeNode</span> <span class="n">element</span><span class="p">,</span> <span class="n">IReference</span><span class="p">[]</span> <span class="n">oldReferences</span><span class="p">);</span>
  <span class="kt">bool</span> <span class="nf">HasReference</span><span class="p">(</span><span class="n">ITreeNode</span> <span class="n">element</span><span class="p">,</span> <span class="n">ICollection</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">names</span><span class="p">);</span>
<span class="p">}</span></code></pre>

<p><code class="code highlight language-text">IReferenceProvider</code> also acts as a façade, this time over the collection of <code class="code highlight language-text">IReferenceFactory</code> instances, and in fact has a slightly different signature, more aimed at consuming references than creating them.</p>

<p>It is responsible for caching the references, and keeping them up to date when the PSI changes. If there is no data cached, or it is not up to date, it calls each of the <code class="code highlight language-text">IReferenceFactory.GetReferences</code> implementations in turn, passing in the old references, if applicable. The returned new references are then cached and returned on demand. It will short circuit the cache update when possible by calling <code class="code highlight language-text">IReferenceFactory.HasReferences</code>. If no reference factory has references here, the cache isn’t consulted or updated. It also includes an optimisation that restores the previously known references if the current PSI transaction is rolled back.</p>

<p>There should be no reason to use <code class="code highlight language-text">ReferenceProviderFactory</code> or <code class="code highlight language-text">IReferenceProvider</code> directly, and is documented to prevent confusion between similarly named classes and interfaces.</p>


                    <div class="last-modified">
                        Last modified: 8 May 2015
                    </div>
                </article>

                <section class="disqus">
                    <div id="disqus_thread"></div>
                </section>
            </div>
        </section>
    </main>
</div>


<script data-main="/resharper/devguide/app/js/main.build" data-baseurl="/resharper/devguide/" src="/resharper/devguide/app/js/vendor/requirejs/require.js"></script>

</body>
</html>

