


<!doctype html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title> / ReSharper  DevGuide</title>
    <link rel="stylesheet" href="/resharper-devguide/app/css/styles.min.css">
<link  rel="stylesheet" href="/resharper-devguide/styles/styles.css"></head>
<body data-id="PSI/Icons">
<div class="wrapper">
    <section class="panel _nav">
        <header class="panel__header">
            <div class="container">
                <form class="search-box">
                    <label for="search-box__input" class="search-box__label">
                        <input type="text" class="search-box__input" id="search-box__input" placeholder="Search ReSharper  DevGuide">
                    </label>
                    <div class="search-box__clear" title="Clear"></div>
                </form>
            </div>
        </header>
        <nav class="panel__content">
            <div class="container _nav">
                <menu class="nav-tree"></menu>
            </div>
            <div class="container _footer panel__footer">
                <p><a href="mailto:feedback@jetbrains.com">Send feedback</a></p>
                <p>&copy; 2000&ndash;2015 <a href="//www.jetbrains.com">JetBrains</a> s.r.o.<br>
                    All rights reserved.</p>
            </div>
        </nav>
    </section>

    <main class="panel _main" role="main">
        <header class="panel__header">
            <div class="container">
                <h3>ReSharper DevGuide</h3>
                
        <div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1">
            <option data-group="primary" value="default" selected>Default</option>
            <option data-group="primary" value="default_for_gnome">GNOME</option>
            <option data-group="primary" value="default_for_kde">KDE</option>
            <option data-group="primary" value="default_for_xwin">XWindow</option>
            <option data-group="primary" value="emacs">Emacs</option>
            <option data-group="primary" value="jbuilder">JBuilder</option>
            <option data-group="primary" value="visual_studio">Visual Studio</option>
            <option data-group="primary" value="netbeans_6.5">NetBeans 6.5</option>
            <option data-group="primary" value="eclipse">Eclipse</option>
            <option data-group="secondary" value="mac_os_x_10.5_">OS X 10.5+</option>
            <option data-group="secondary" value="mac_os_x">OS X</option>
            <option data-group="secondary" value="eclipse_mac_os_x">OS X Eclipse</option></select>
        </div>
    
                <div class="panel-trigger"></div>
            </div>
        </header>
        <section class="panel__content">
            <div class="container">
                <article class="article" data-shortcut-switcher="false">

                    
                    <a name="psi-icons" class="elem-anchor"></a>
<h1>PSI Icons<a href="#psi-icons" class="anchor-link"><span></span></a></h1>

<p>The PSI needs to be able to display icons to help identify code elements in completion, navigation or find usage result lists. The PSI can display different icons to distinguish between classes, constructors, methods, parameters, etc. It can also show specific icons for CSS class IDs, HTML elements and unit test elements.</p>

<p>While the <a href="../Platform/Shell/Icons.html"><span>Shell provides the <code class="code highlight language-text">ThemedIconManager</code> class</span></a> in order to load and create icons, it is a low level API. It provides no means for getting the icon for a class, other than explicitly loading <code class="code highlight language-text">PsiSymbolsThemedIcons.Class.Id</code>. The PSI provides the <code class="code highlight language-text">PsiIconManager</code> to retrieve icons for a specific declared element.</p>

<p>The <code class="code highlight language-text">PsiIconManager</code> provides the following methods and properties:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">PsiIconManager</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="k">abstract</span> <span class="n">IconId</span> <span class="nf">GetDummyImage</span><span class="p">();</span>
  <span class="k">public</span> <span class="k">abstract</span> <span class="n">IconId</span> <span class="nf">GetImage</span><span class="p">(</span><span class="n">IDeclaredElement</span> <span class="n">element</span><span class="p">,</span> <span class="n">PsiLanguageType</span> <span class="n">language</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">drawExtensions</span><span class="p">);</span>
  <span class="k">public</span> <span class="k">abstract</span> <span class="n">IconId</span> <span class="nf">GetImage</span><span class="p">(</span><span class="n">DeclaredElementType</span> <span class="n">elementType</span><span class="p">);</span>
  <span class="k">public</span> <span class="k">abstract</span> <span class="n">IconId</span> <span class="nf">GetImage</span><span class="p">(</span><span class="n">DeclaredElementType</span> <span class="n">elementType</span><span class="p">,</span> <span class="n">PsiIconExtension</span> <span class="n">extensions</span><span class="p">);</span>
  <span class="k">public</span> <span class="k">abstract</span> <span class="n">IconId</span> <span class="nf">AttachExtensions</span><span class="p">(</span><span class="n">IconId</span> <span class="n">image</span><span class="p">,</span> <span class="n">PsiIconExtension</span> <span class="n">extensions</span><span class="p">);</span>
  <span class="k">public</span> <span class="k">abstract</span> <span class="n">IconId</span> <span class="n">KeywordIcon</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
  <span class="c1">// ...</span>
<span class="p">}</span></code></pre>

<p>The <code class="code highlight language-text">PsiIconExtension</code> type is a flags based enum, which provides the modifiers, such as public, private, internal, or abstract, virtual, static, etc. These modifiers are used to create a composite icon, with the base icon representing the element being overlayed with another icon that represents the modifier.</p>

<ul>
  <li>
    <p><strong><code class="code highlight language-text">GetDummyImage</code></strong> returns a dummy, placeholder image, which is to be used if the icon manager cannot return a more specific image. The pattern for usage is usually:</p>

    <p><code class="code highlight language-text">csharp
  var iconId = manager.GetImage(CLRDeclaredElementType.CONSTRUCTOR) ?? manager.GetDummyImage();</code></p>
  </li>
  <li>
    <p><strong><code class="code highlight language-text">GetImage</code></strong> provides several overloads. The first takes an instance of <code class="code highlight language-text">IDeclaredElement</code>, and will return an icon specific to that element, for example, given an element for a class declaration, the method will return an <code class="code highlight language-text">IconId</code> for the class icon. The <code class="code highlight language-text">drawExtensions</code> parameter is true if the element’s modifiers (public, private, abstract, etc.) are used to modify the icon.</p>

    <p>The other overloads use an instance of <code class="code highlight language-text">DeclaredElementType</code>, which is a metadata class that describes how various declared element types are presented, including presentable name and which icon to use. ReSharper ships with several classes that describe element types, such as <code class="code highlight language-text">CSharpDeclaredElement</code>, <code class="code highlight language-text">CssDeclaredElementType</code> or <code class="code highlight language-text">WebConfigDeclaredElementType</code>. Each class has several static fields that provide instances of the element type, such as <code class="code highlight language-text">WebConfigDeclaredElementType.WEB_CONFIG_TAG_NAME</code>.</p>
  </li>
  <li>
    <p><strong><code class="code highlight language-text">AttachExtensions</code></strong> will add the expected modifier overlays to the passed icon, marking it as private, protected, abstract, static, etc.</p>
  </li>
  <li>
    <p><strong><code class="code highlight language-text">KeywordIcon</code></strong> simply returns the <code class="code highlight language-text">IconId</code> of the icon representing keywords.</p>
  </li>
</ul>

<p>Typically, the icon manager will return an icon when <code class="code highlight language-text">GetImage</code> is called. If it returns <code class="code highlight language-text">null</code>, use the image returned by <code class="code highlight language-text">GetDummyImage</code> instead.</p>

<a name="extending-the-icon-manager" class="elem-anchor"></a>
<h2>Extending the icon manager<a href="#extending-the-icon-manager" class="anchor-link"><span></span></a></h2>

<p>By default, the icon manager will try to return a specific icon for a given declared element. If it can’t find one, it returns the icon from the element’s <code class="code highlight language-text">DeclaredElementType</code>. In order to find a specific icon, it asks an extensible collection of icon providers, which all implement the <code class="code highlight language-text">IDeclaredElementIconProvider</code> interface:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IDeclaredElementIconProvider</span>
<span class="p">{</span>
  <span class="n">IconId</span> <span class="nf">GetImageId</span><span class="p">(</span><span class="n">IDeclaredElement</span> <span class="n">declaredElement</span><span class="p">,</span> <span class="n">PsiLanguageType</span> <span class="n">languageType</span><span class="p">,</span> <span class="k">out</span> <span class="kt">bool</span> <span class="n">canApplyExtensions</span><span class="p">);</span>
<span class="p">}</span></code></pre>

<p>ReSharper ships with a number of language specific providers, such as the C# provider that checks to see if the declared element is a C# extension method, indexer property or finalizer (all of which would otherwise be classed as a simple method), and returns back a specific icon in each case. If the element isn’t one of these, it returns null. It also returns <code class="code highlight language-text">true</code> in the <code class="code highlight language-text">canApplyExtensions</code> parameter to indicate that this element can have modifiers, based on <code class="code highlight language-text">PsiIconExtension</code>.</p>

<p>Furthermore, ReSharper ships with a colour icon provider, which recognises type members that are colour properties, and returns a <code class="code highlight language-text">ColorIconId</code> to match. This provider returns <code class="code highlight language-text">false</code> in <code class="code highlight language-text">canApplyExtensions</code>. ReSharper also ships a unit test icon provider, which checks to see if the declared element is part of a unit test, and returns an appropriate unit test icon.</p>

<p>The collection can be extended by creating a class that implements <code class="code highlight language-text">IDeclaredElementIconProvider</code> and is decorated with the <code class="code highlight language-text">[DeclaredElementIconProvider]</code> attribute. This scopes the class to PSI-shared component lifetime (that is, the same lifetime as a <code class="code highlight language-text">ShellComponent</code>). Should the class need to have a narrower lifetime, such as <code class="code highlight language-text">[SolutionComponent]</code>, it is possible to call <code class="code highlight language-text">PsiIconManager.AddExtension</code> in the provider’s constructor, passing in it’s own <code class="code highlight language-text">Lifetime</code> for cleanup. The unit test icon provider does this, as it depends on components that have solution lifetime scope.</p>

<p>The <code class="code highlight language-text">IDeclaredElementIconExtensionProvider</code> can be implemented to extend the process for deciding what modifiers should be applied to the icon (private, public, etc.). The class should be decorated with the <code class="code highlight language-text">[DeclaredElementIconExtensionProvider]</code> attribute, or can also be registered by calling <code class="code highlight language-text">PsiIconManager.AddExtension</code> if the component has different lifetime requirements. This provider is currently implemented for CLR and C++ elements.</p>

<a name="loading-icons-manually" class="elem-anchor"></a>
<h2>Loading icons manually<a href="#loading-icons-manually" class="anchor-link"><span></span></a></h2>

<p>It is not recommended to load icons directly, but they are available in the <a href="../Platform/Shell/Icons/ConsumingIcons.html"><span><code class="code highlight language-text">ThemedIconManager</code></span></a>. Simply use the icon IDs defined in the <code class="code highlight language-text">PsiSymbolsThemedIcons</code> class, and use <a href="../Platform/Shell/Icons/IconTypes.html#composite-icons"><span><code class="code highlight language-text">CompositeIconId.Compose</code></span></a> method to apply modifiers. There are language specific icons in other classes, such <code class="code highlight language-text">PsiCssThemedIcons</code> or <code class="code highlight language-text">PsiBuildScriptsThemedIcons</code>.</p>

<p>The <code class="code highlight language-text">PsiIconManager</code> provides a more flexible and extensible way of getting the correct icon.</p>


                    <div class="last-modified">
                        Last modified: 8 May 2015
                    </div>
                </article>

                <section class="disqus">
                    <div id="disqus_thread"></div>
                </section>
            </div>
        </section>
    </main>
</div>


<script data-main="/resharper-devguide/app/js/main.build" data-baseurl="/resharper-devguide/" src="/resharper-devguide/app/js/vendor/requirejs/require.js"></script>

</body>
</html>

