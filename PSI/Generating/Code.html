


<!doctype html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title> / ReSharper  DevGuide</title>
    <link rel="stylesheet" href="/resharper/devguide/app/css/styles.min.css">
<link  rel="stylesheet" href="/resharper/devguide/styles/styles.css"></head>
<body data-id="PSI/Generating/Code">
<div class="wrapper">
    <section class="panel _nav">
        <header class="panel__header">
            <div class="container">
                <form class="search-box">
                    <label for="search-box__input" class="search-box__label">
                        <input type="text" class="search-box__input" id="search-box__input" placeholder="Search ReSharper  DevGuide">
                    </label>
                    <div class="search-box__clear" title="Clear"></div>
                </form>
            </div>
        </header>
        <nav class="panel__content">
            <div class="container _nav">
                <menu class="nav-tree"></menu>
            </div>
            <div class="container _footer panel__footer">
                <p><a href="mailto:feedback@jetbrains.com">Send feedback</a></p>
                <p>&copy; 2000&ndash;2015 <a href="//www.jetbrains.com">JetBrains</a> s.r.o.<br>
                    All rights reserved.</p>
            </div>
        </nav>
    </section>

    <main class="panel _main" role="main">
        <header class="panel__header">
            <div class="container">
                <h3>ReSharper DevGuide</h3>
                
        <div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1">
            <option data-group="primary" value="default" selected>Default</option>
            <option data-group="primary" value="default_for_gnome">GNOME</option>
            <option data-group="primary" value="default_for_kde">KDE</option>
            <option data-group="primary" value="default_for_xwin">XWindow</option>
            <option data-group="primary" value="emacs">Emacs</option>
            <option data-group="primary" value="jbuilder">JBuilder</option>
            <option data-group="primary" value="visual_studio">Visual Studio</option>
            <option data-group="primary" value="netbeans_6.5">NetBeans 6.5</option>
            <option data-group="primary" value="eclipse">Eclipse</option>
            <option data-group="secondary" value="mac_os_x_10.5_">OS X 10.5+</option>
            <option data-group="secondary" value="mac_os_x">OS X</option>
            <option data-group="secondary" value="eclipse_mac_os_x">OS X Eclipse</option></select>
        </div>
    
                <div class="panel-trigger"></div>
            </div>
        </header>
        <section class="panel__content">
            <div class="container">
                <article class="article" data-shortcut-switcher="false">

                    
                    <a name="generating-code" class="elem-anchor"></a>
<h1>Generating Code<a href="#generating-code" class="anchor-link"><span></span></a></h1>

<p>If you plan to write plug-ins that generate code, it’s important to understand how to use ReSharper to create new code elements and insert them into existing types.</p>

<p>Depending on the situation, you will most likely encounter two usage patterns:</p>

<ul>
  <li>One element needs to be replaced by another. This is typically achieved by either calling the <code class="code highlight language-text">ReplaceBy()</code> method on the element to be replaced or, if this method is not available, by physically removing one element and adding another.</li>
  <li>An element needs to be inserted as a child of another element. In this case, there is typically a method in the API for doing exactly that.</li>
</ul>

<a name="element-factory" class="elem-anchor"></a>
<h2>Element factory<a href="#element-factory" class="anchor-link"><span></span></a></h2>

<p>The Element Factory is a class which is used to manufacture all types of entities, be it statements or whole declarations. The element factory is created via a <code class="code highlight language-text">GetInstance()</code> method, which is supplied the corresponding <code class="code highlight language-text">PsiModule</code>:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="kt">var</span> <span class="n">factory</span> <span class="p">=</span> <span class="n">CSharpElementFactory</span><span class="p">.</span><span class="n">GetInstance</span><span class="p">(</span><span class="n">provider</span><span class="p">.</span><span class="n">PsiModule</span><span class="p">);</span></code></pre>

<p>Having acquired the element factory, you can now use it to manufacture various objects by invoking one of its methods. For example, to create a simple statement, you would write the following simple piece of code:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="n">ICSharpStatement</span> <span class="n">st</span> <span class="p">=</span> <span class="n">factory</span><span class="p">.</span><span class="n">CreateStatement</span><span class="p">(</span><span class="s">&quot;int x = 0;&quot;</span><span class="p">,</span> <span class="n">EmptyArray</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;.</span><span class="n">Instance</span><span class="p">);</span></code></pre>

<p>You’re probably curious to know what the second parameter is. Essentially, the second parameter is an array of <code class="code highlight language-text">object</code> which act in a similar way to the way the <code class="code highlight language-text">args</code> parameters act in a <code class="code highlight language-text">string.Format()</code> call.</p>

<p>Why are these parameters needed? Well, interestingly enough, the parameters allow you to specify additional checks that need to be made during the generation of code. For example, let us suppose that we need to create a statement similar to <code class="code highlight language-text">int x = 0;</code>, but the name of the variable is provided elsewhere. What would happen if that variable’s name was <code class="code highlight language-text">int</code> or <code class="code highlight language-text">event</code>? Creating the statement would result in erroneous code.</p>

<p>But consider the following adjustment:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="n">ICSharpStatement</span> <span class="n">st</span> <span class="p">=</span> <span class="n">factory</span><span class="p">.</span><span class="n">CreateStatement</span><span class="p">(</span><span class="s">&quot;int $0 = 0;&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="kt">object</span><span class="p">[]{</span><span class="n">varEvent</span><span class="p">});</span></code></pre>

<p>Now we’re passing the variable as a parameter, with the dollar <code class="code highlight language-text">$n</code> notation used to specify the <code class="code highlight language-text">n</code>th argument to be inserted. If <code class="code highlight language-text">varEvent</code> denotes an identifier of <code class="code highlight language-text">event</code>, the generated C# statement would now be:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="kt">int</span> <span class="n">@event</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span></code></pre>

<a name="type-factory" class="elem-anchor"></a>
<h2>Type factory<a href="#type-factory" class="anchor-link"><span></span></a></h2>

<p>Creating types is an important task in the ReSharper ecosystem. For example, say you wanted to write a Context Action to implement change notification in a class. This would require you to create, say, an <code class="code highlight language-text">INotifyPropertyChanged</code> interface type.</p>

<p>Types are created using the <code class="code highlight language-text">TypeFactory</code>. There are many overloads for creating types. The simplest simply creates a type when provided the type’s FQN (fully qualified name):</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="n">IDeclaredType</span> <span class="n">propertyChangedInterface</span> <span class="p">=</span>
  <span class="n">TypeFactory</span><span class="p">.</span><span class="n">CreateTypeByCLRName</span><span class="p">(</span><span class="s">&quot;System.ComponentModel.INotifyPropertyChanged&quot;</span><span class="p">,</span> <span class="n">provider</span><span class="p">.</span><span class="n">PsiModule</span><span class="p">);</span></code></pre>

<p>Creating a generic type is a little bit more complicated. You first use the <code class="code highlight language-text">TypeElementUtil</code> helper class to get the type element for the generic type. The ‘backquote notation’ is used for this, so that <code class="code highlight language-text">Lazy&lt;T&gt;</code> effectively becomes <code class="code highlight language-text">Lazy</code>1<code class="code highlight language-text">. After you have received the type element, you call the</code>TypeFactory` method to create the type, providing first the type element you created, and then an array of types that specify the generic arguments:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="kt">var</span> <span class="n">lazyTypeElem</span> <span class="p">=</span> <span class="n">TypeElementUtil</span><span class="p">.</span><span class="n">GetTypeElementByClrName</span><span class="p">(</span><span class="k">new</span> <span class="n">ClrTypeName</span><span class="p">(</span><span class="s">&quot;System.Lazy`1&quot;</span><span class="p">),</span> <span class="n">psiModule</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">lazyType</span> <span class="p">=</span> <span class="n">TypeFactory</span><span class="p">.</span><span class="n">CreateType</span><span class="p">(</span><span class="n">lazyTypeElem</span><span class="p">,</span> <span class="n">thisType</span><span class="p">);</span></code></pre>

<p>Please note that if you want to use the type to create, e.g., statements with the <code class="code highlight language-text">$</code> notation, you cannot simply use the parameter of <code class="code highlight language-text">IDeclaredType</code> - you need to call <code class="code highlight language-text">GetTypeElement()</code> on it.</p>



                    <div class="last-modified">
                        Last modified: 8 May 2015
                    </div>
                </article>

                <section class="disqus">
                    <div id="disqus_thread"></div>
                </section>
            </div>
        </section>
    </main>
</div>


<script data-main="/resharper/devguide/app/js/main.build" data-baseurl="/resharper/devguide/" src="/resharper/devguide/app/js/vendor/requirejs/require.js"></script>

</body>
</html>

