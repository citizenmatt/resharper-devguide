


<!doctype html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title> / ReSharper  DevGuide</title>
    <link rel="stylesheet" href="/resharper-devguide/app/css/styles.min.css">
<link  rel="stylesheet" href="/resharper-devguide/styles/styles.css"></head>
<body data-id="CustomLanguages/InjectedPsi">
<div class="wrapper">
    <section class="panel _nav">
        <header class="panel__header">
            <div class="container">
                <form class="search-box">
                    <label for="search-box__input" class="search-box__label">
                        <input type="text" class="search-box__input" id="search-box__input" placeholder="Search ReSharper  DevGuide">
                    </label>
                    <div class="search-box__clear" title="Clear"></div>
                </form>
            </div>
        </header>
        <nav class="panel__content">
            <div class="container _nav">
                <menu class="nav-tree"></menu>
            </div>
            <div class="container _footer panel__footer">
                <p><a href="mailto:feedback@jetbrains.com">Send feedback</a></p>
                <p>&copy; 2000&ndash;2015 <a href="//www.jetbrains.com">JetBrains</a> s.r.o.<br>
                    All rights reserved.</p>
            </div>
        </nav>
    </section>

    <main class="panel _main" role="main">
        <header class="panel__header">
            <div class="container">
                <h3>ReSharper DevGuide</h3>
                
        <div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1">
            <option data-group="primary" value="default" selected>Default</option>
            <option data-group="primary" value="default_for_gnome">GNOME</option>
            <option data-group="primary" value="default_for_kde">KDE</option>
            <option data-group="primary" value="default_for_xwin">XWindow</option>
            <option data-group="primary" value="emacs">Emacs</option>
            <option data-group="primary" value="jbuilder">JBuilder</option>
            <option data-group="primary" value="visual_studio">Visual Studio</option>
            <option data-group="primary" value="netbeans_6.5">NetBeans 6.5</option>
            <option data-group="primary" value="eclipse">Eclipse</option>
            <option data-group="secondary" value="mac_os_x_10.5_">OS X 10.5+</option>
            <option data-group="secondary" value="mac_os_x">OS X</option>
            <option data-group="secondary" value="eclipse_mac_os_x">OS X Eclipse</option></select>
        </div>
    
                <div class="panel-trigger"></div>
            </div>
        </header>
        <section class="panel__content">
            <div class="container">
                <article class="article" data-shortcut-switcher="false">

                    
                    <a name="injected-psi" class="elem-anchor"></a>
<h1>Injected PSI<a href="#injected-psi" class="anchor-link"><span></span></a></h1>

<p>ReSharper 7 introduces a new lightweight mechanism for ‘slicing’ a single physical code file into multiple PSI files corresponding to the languages that are used within that file. This mechanism is called <em>Injected PSI</em>. An example of an injected PSI file is a JSON file in a property of an HTML control in a JavaScript Metro app. Since the injected PSI mechanism is still being introduced, other pertinent areas (e.g., JS and CSS in HTML) currently do not use this mechanism.</p>

<a name="psi-types" class="elem-anchor"></a>
<h2>PSI Types<a href="#psi-types" class="anchor-link"><span></span></a></h2>

<p>As it stands, there are two types of PSI files available right now:</p>

<ul>
  <li>Non-injected PSI files - these are primary PSI files and PSI files implemented by the old mechanisms. One language may only have one non-injected PSI file. All C# and VB files are currently non-injected.</li>
  <li>Injected PSI files - these are PSI files for additional languages, implemented by a brand-new mechanism. At the moment, this mechanism is only used in JSON within HTML in JS Metro apps. In future, this mechanism will handle CSS and JS within HTML and would be also used for new features.</li>
</ul>

<p>Consequently, API calls to <code class="code highlight language-text">GetPsiFile()</code> need to be replaced by corresponding calls that have the extra range parameters. Typically, acquisition of a PSI file requires an additional parameter containing a <code class="code highlight language-text">DocumentOffset/DocumentRange</code>. (Alternatively, one can iterate all PSI files, but this may come with a performance cost.) For example:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="kt">var</span> <span class="n">range</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DocumentRange</span><span class="p">(</span><span class="n">textControl</span><span class="p">.</span><span class="n">Document</span><span class="p">,</span> <span class="n">textControl</span><span class="p">.</span><span class="n">Caret</span><span class="p">.</span><span class="n">Offset</span><span class="p">());</span>
<span class="kt">var</span> <span class="n">htmlFile</span> <span class="p">=</span> <span class="p">(</span><span class="n">IHtmlFile</span><span class="p">)</span><span class="n">projectFile</span><span class="p">.</span><span class="n">GetPsiFile</span><span class="p">&lt;</span><span class="n">HtmlLanguage</span><span class="p">&gt;(</span><span class="n">range</span><span class="p">);</span></code></pre>

<p>Alternatively, for primary PSI files you can replace these calls to <code class="code highlight language-text">GetNonInjectedPsiFile()</code> (this method is contained in the <code class="code highlight language-text">PsiManagerExtensions</code> class). You can also use this method for all C# and VB files, even for C# and VB in ASP.NET and Razor, although this is not recommended. For example:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_csharp"><span class="kt">var</span> <span class="n">file</span> <span class="p">=</span> <span class="n">process</span><span class="p">.</span><span class="n">SourceFile</span><span class="p">.</span><span class="n">GetNonInjectedPsiFile</span><span class="p">&lt;</span><span class="n">CSharpLanguage</span><span class="p">&gt;();</span></code></pre>


                    <div class="last-modified">
                        Last modified: 8 May 2015
                    </div>
                </article>

                <section class="disqus">
                    <div id="disqus_thread"></div>
                </section>
            </div>
        </section>
    </main>
</div>


<script data-main="/resharper-devguide/app/js/main.build" data-baseurl="/resharper-devguide/" src="/resharper-devguide/app/js/vendor/requirejs/require.js"></script>

</body>
</html>

